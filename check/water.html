<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- ‚úÖ [‰øÆÊ≠£1] CSPÔºöÂ∞ÅÈéñÊâÄÊúâÂ§ñÈÉ®‰æÜÊ∫êÔºåÂÉÖÂÖÅË®± inline style/script Ëàá data: ÂúñÁâá -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'none'; style-src 'unsafe-inline'; script-src 'unsafe-inline'; img-src data:; connect-src 'none'; font-src 'none';">

  <title>ÈÜ´ÁôÇÁî®Ê∞¥Â∫´Â≠òÂõûÂ†±Á≥ªÁµ±</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üíß</text></svg>">

  <!-- ‚úÖ [‰øÆÊ≠£2] ÁßªÈô§ Google Fonts Â§ñÈÉ® CDNÔºåÊîπÁî®Á≥ªÁµ±Â≠óÂûãÂ†ÜÁñä -->
  <!-- ÂéüÊú¨Ôºö<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC..."> -->

  <style>
    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #21253a;
      --border: #2a2f47;
      --border-bright: #3a4060;
      --text: #e8ecf0;
      --text-muted: #7a8199;
      --text-dim: #4a5068;
      --accent: #4f8ef7;
      --accent-glow: rgba(79,142,247,0.15);
      --yellow: #f7c94f;
      --yellow-glow: rgba(247,201,79,0.12);
      --red: #f74f6a;
      --red-glow: rgba(247,79,106,0.12);
      --green: #4ff7a0;
      --green-glow: rgba(79,247,160,0.1);

      /* ‚úÖ [‰øÆÊ≠£2] Á≥ªÁµ±Â≠óÂûãÂ†ÜÁñäÔºömacOS/iOS ‚Üí PingFang TCÔºåWindows ‚Üí ÂæÆËªüÊ≠£ÈªëÈ´îÔºåAndroid ‚Üí Noto Sans TC */
      --font-body: -apple-system, BlinkMacSystemFont, "PingFang TC", "Microsoft JhengHei",
                   "Noto Sans TC", "Heiti TC", sans-serif;
      --font-mono: "SF Mono", "Cascadia Code", "Consolas", "Courier New", monospace;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-body);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(79,142,247,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(79,142,247,0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      top: -30vh;
      left: -20vw;
      width: 60vw;
      height: 60vh;
      background: radial-gradient(ellipse, rgba(79,142,247,0.06) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    #app { position: relative; z-index: 1; max-width: 720px; margin: 0 auto; padding: 0 16px 80px; }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15,17,23,0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 -16px;
    }

    .header-left { display: flex; align-items: center; gap: 10px; }
    .header-icon {
      width: 34px; height: 34px;
      background: linear-gradient(135deg, #4f8ef7, #7b5ea7);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      box-shadow: 0 0 16px rgba(79,142,247,0.3);
    }
    .header-title { font-size: 16px; font-weight: 700; letter-spacing: 0.02em; }
    .header-sub { font-size: 11px; color: var(--text-muted); font-family: var(--font-mono); }

    .btn-save {
      display: flex; align-items: center; gap: 6px;
      background: var(--surface2);
      border: 1px solid var(--border-bright);
      color: var(--text-muted);
      padding: 7px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-family: var(--font-body);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-save:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-glow); }

    .tabs {
      display: flex; gap: 4px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 4px;
      margin-top: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 700;
      font-family: var(--font-body);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab-btn.active {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 4px 16px rgba(79,142,247,0.4);
    }

    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
    }

    .section-title {
      display: flex; align-items: center; gap: 8px;
      font-size: 14px; font-weight: 700; color: var(--text-muted);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      font-family: var(--font-mono);
    }

    .section-title .dot {
      width: 8px; height: 8px;
      background: var(--green);
      border-radius: 50%;
      box-shadow: 0 0 8px var(--green);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    .btn-export {
      display: flex; align-items: center; gap: 6px;
      background: rgba(79,142,247,0.1);
      border: 1px solid rgba(79,142,247,0.3);
      color: var(--accent);
      padding: 7px 12px;
      border-radius: 7px;
      font-size: 12px;
      font-family: var(--font-body);
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.02em;
    }
    .btn-export:hover { background: rgba(79,142,247,0.18); box-shadow: 0 0 12px rgba(79,142,247,0.2); }
    .btn-export:active { transform: scale(0.96); }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      margin-top: 20px;
    }

    .product-row {
      display: flex; align-items: center; gap: 16px;
      padding: 18px;
      border-bottom: 1px solid var(--border);
      transition: background 0.15s;
    }
    .product-row:last-child { border-bottom: none; }
    .product-row:hover { background: rgba(255,255,255,0.02); }

    .product-num {
      width: 24px; height: 24px;
      background: var(--surface2);
      border: 1px solid var(--border-bright);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 700;
      color: var(--text-dim);
      font-family: var(--font-mono);
      flex-shrink: 0;
    }

    .product-visual {
      width: 56px; height: 64px;
      border-radius: 10px;
      border: 1px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      overflow: hidden;
    }
    .product-visual svg { width: auto; height: 56px; }

    .product-info { flex: 1; min-width: 0; }
    .product-brand {
      font-size: 10px;
      font-family: var(--font-mono);
      color: var(--text-dim);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .product-name { font-size: 14px; font-weight: 700; line-height: 1.3; }
    .product-unit { font-size: 11px; color: var(--text-muted); margin-top: 2px; font-family: var(--font-mono); }

    .stepper {
      display: flex; align-items: center;
      background: var(--surface2);
      border: 1px solid var(--border-bright);
      border-radius: 10px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .stepper-btn {
      width: 40px; height: 48px;
      border: none; background: transparent;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      color: var(--text-muted);
      transition: all 0.15s;
      font-size: 18px;
    }
    .stepper-btn:hover { background: rgba(255,255,255,0.05); color: var(--text); }
    .stepper-btn.plus:hover { color: var(--accent); background: var(--accent-glow); }
    .stepper-btn.minus:hover { color: var(--red); background: var(--red-glow); }
    .stepper-btn:active { transform: scale(0.9); }

    .stepper-divider { width: 1px; height: 28px; background: var(--border-bright); flex-shrink: 0; }

    .stepper-input {
      width: 62px;
      text-align: center;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 20px;
      font-weight: 700;
      font-family: var(--font-mono);
      outline: none;
      -moz-appearance: textfield;
    }
    .stepper-input::-webkit-inner-spin-button,
    .stepper-input::-webkit-outer-spin-button { -webkit-appearance: none; }

    .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }

    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    thead tr { background: var(--surface2); }
    th {
      padding: 10px 14px;
      font-weight: 700;
      font-family: var(--font-mono);
      font-size: 11px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--text-muted);
      text-align: center;
    }
    th:first-child { text-align: left; }

    td {
      padding: 12px 14px;
      text-align: center;
      border-bottom: 1px solid var(--border);
      color: var(--text-muted);
      font-family: var(--font-mono);
    }
    td:first-child {
      text-align: left; font-family: var(--font-body);
      font-weight: 600; color: var(--text); font-size: 12px;
    }
    tr:last-child td { border-bottom: none; }
    .td-total { font-weight: 700; color: var(--accent) !important; font-size: 14px; }
    .total-row td { background: rgba(79,142,247,0.05); }

    #toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      background: var(--surface2);
      border: 1px solid var(--border-bright);
      color: var(--text);
      padding: 12px 20px;
      border-radius: 40px;
      font-size: 13px;
      font-weight: 600;
      display: flex; align-items: center; gap: 8px;
      z-index: 9999;
      white-space: nowrap;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s;
      opacity: 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }
    #toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    #toast .toast-icon { font-size: 16px; }

    .color-yellow .product-visual { background: var(--yellow-glow); border-color: rgba(247,201,79,0.2); }
    .color-yellow .product-name { color: var(--yellow); }
    .color-blue .product-visual { background: var(--accent-glow); border-color: rgba(79,142,247,0.2); }
    .color-blue .product-name { color: var(--accent); }
    .color-red .product-visual { background: var(--red-glow); border-color: rgba(247,79,106,0.2); }
    .color-red .product-name { color: var(--red); }

    @media (max-width: 480px) {
      .product-row { flex-wrap: wrap; }
      .stepper { margin-left: auto; }
    }

    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }
    input[type="number"] { -moz-appearance: textfield; }
  </style>
</head>
<body>

<div id="app">
  <header>
    <div class="header-left">
      <div class="header-icon">üíß</div>
      <div>
        <div class="header-title">ÈÜ´ÁôÇÁî®Ê∞¥Â∫´Â≠òÂõûÂ†±</div>
        <div class="header-sub">INVENTORY TRACKER v2.1</div>
      </div>
    </div>
    <button class="btn-save" onclick="handleSave()">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
        <polyline points="17 21 17 13 7 13 7 21"/>
        <polyline points="7 3 7 8 15 8"/>
      </svg>
      ÂÑ≤Â≠ò
    </button>
  </header>

  <div class="tabs" id="tabs"></div>

  <div class="card" id="editorCard">
    <div class="section-header">
      <div class="section-title">
        <span class="dot"></span>
        <span id="editorTitle">Ê≠£Âú®Áõ§ÈªûÔºö9Ê®ì</span>
      </div>
      <button class="btn-export" onclick="handleExport()">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <rect x="9" y="9" width="13" height="13" rx="2"/>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
        </svg>
        ÂåØÂá∫ÊñáÂ≠ó
      </button>
    </div>
    <div id="productList"></div>
  </div>

  <div class="card" style="margin-top:20px; margin-bottom:20px;">
    <div class="section-header">
      <div class="section-title">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="color:var(--accent)">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
        </svg>
        ÂÖ®Èô¢Âç≥ÊôÇÁ∏ΩË¶Ω
      </div>
    </div>
    <div class="table-wrapper">
      <table id="summaryTable"></table>
    </div>
  </div>
</div>

<div id="toast">
  <span class="toast-icon">‚úì</span>
  <span id="toastMsg"></span>
</div>

<script>
// ‚îÄ‚îÄ SVG IconsÔºàÁ°¨Á∑®Á¢ºÂ∏∏Êï∏ÔºåÁÑ° XSS È¢®Èö™Ôºâ‚îÄ‚îÄ
const svgs = {
  '500ml': `<svg viewBox="0 0 100 200">
    <defs><linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f1f5f9" stop-opacity="0.8"/><stop offset="50%" stop-color="#ffffff" stop-opacity="0.9"/><stop offset="100%" stop-color="#e2e8f0" stop-opacity="0.8"/></linearGradient></defs>
    <rect x="25" y="60" width="50" height="130" rx="10" fill="url(#g1)" stroke="#cbd5e1" stroke-width="1"/>
    <path d="M 35 60 L 40 30 L 60 30 L 65 60 Z" fill="url(#g1)" stroke="#cbd5e1" stroke-width="1"/>
    <path d="M 38 15 h 24 v 15 h -24 z" fill="#ef4444"/>
    <rect x="37" y="14" width="26" height="4" rx="1" fill="#dc2626"/>
    <rect x="25" y="90" width="50" height="70" fill="#facc15"/>
    <rect x="25" y="100" width="50" height="50" fill="#ffffff"/>
    <rect x="30" y="93" width="40" height="5" rx="2" fill="#573312"/>
    <text x="50" y="125" font-size="8" text-anchor="middle" fill="#000" font-weight="900">Ê≥®Â∞ÑÁî®Ê∞¥</text>
    <text x="50" y="155" font-size="4" text-anchor="middle" fill="#333" font-weight="bold">500ml</text>
  </svg>`,

  '1000ml': `<svg viewBox="0 0 100 200">
    <defs><linearGradient id="g2" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f8fafc" stop-opacity="0.7"/><stop offset="50%" stop-color="#ffffff" stop-opacity="0.9"/><stop offset="100%" stop-color="#e2e8f0" stop-opacity="0.7"/></linearGradient></defs>
    <rect x="20" y="60" width="60" height="130" rx="10" fill="url(#g2)" stroke="#cbd5e1" stroke-width="1"/>
    <path d="M 20 65 Q 20 40 35 35 L 65 35 Q 80 40 80 65 Z" fill="url(#g2)" stroke="#cbd5e1" stroke-width="1"/>
    <rect x="42" y="15" width="16" height="20" rx="2" fill="#ffffff" stroke="#cbd5e1"/>
    <rect x="44" y="5" width="8" height="10" rx="1" fill="#f1f5f9" stroke="#cbd5e1"/>
    <rect x="22" y="80" width="56" height="85" fill="#60a5fa" rx="2"/>
    <text x="50" y="110" font-size="7" text-anchor="middle" fill="#1e3a8a" font-weight="900">Ê≤ñÊ¥óÁî®Ëí∏È§æÊ∞¥</text>
    <text x="50" y="155" font-size="4" text-anchor="middle" fill="#1e3a8a" font-weight="bold">1000ml</text>
  </svg>`,

  '2000ml': `<svg viewBox="0 0 100 200">
    <defs><linearGradient id="g3" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f8fafc" stop-opacity="0.8"/><stop offset="50%" stop-color="#ffffff" stop-opacity="0.9"/><stop offset="100%" stop-color="#f1f5f9" stop-opacity="0.8"/></linearGradient></defs>
    <path d="M 15 25 Q 15 15 25 15 L 75 15 Q 85 15 85 25 L 85 175 Q 85 185 75 185 L 25 185 Q 15 185 15 175 Z" fill="url(#g3)" stroke="#94a3b8" stroke-width="1.5"/>
    <path d="M 35 15 Q 50 -5 65 15" fill="none" stroke="#94a3b8" stroke-width="2"/>
    <rect x="35" y="185" width="10" height="15" rx="2" fill="#f8fafc" stroke="#94a3b8"/>
    <rect x="55" y="185" width="12" height="18" rx="2" fill="#3b82f6"/>
    <text x="50" y="55" font-size="6" text-anchor="middle" fill="#dc2626" font-weight="bold">Ê∏õËèåÊ≤ñÊ¥óÁî®Ëí∏È§æÊ∞¥</text>
    <text x="50" y="72" font-size="5" text-anchor="middle" fill="#dc2626" font-weight="bold">IRRIGATION</text>
    <text x="80" y="40" font-size="4" text-anchor="end" fill="#dc2626" font-weight="bold">2.0L</text>
  </svg>`
};

// ‚îÄ‚îÄ Constants ‚îÄ‚îÄ
const LOCATIONS = ['9Ê®ì', '13Ê®ì', 'ÊÉÖ‰∫∫Êπñ'];
const PRODUCTS = [
  { id: '500ml',  name: '500mlËí∏È§æÊ∞¥Áì∂',  brand: 'XINTONG / ‰ø°Êù±', color: 'color-yellow' },
  { id: '1000ml', name: '1000mlËí∏È§æÊ∞¥Áì∂', brand: 'JISENG / ÊøüÁîü',   color: 'color-blue'  },
  { id: '2000ml', name: '2000mlËí∏È§æÊ∞¥Ë¢ã', brand: 'YONGFENG / Ê∞∏Ë±ê', color: 'color-red'   },
];

const STORAGE_KEY = 'medical-water-inventory-v2';

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let activeTab = '9Ê®ì';
let inventory = loadInventory();

// ‚úÖ [‰øÆÊ≠£3] loadInventoryÔºöÂö¥Ê†ºÈ©óË≠â localStorage Êï∏ÂÄº
// Èò≤ÁØÑ Stored XSSÔºöÁ¢∫‰øùÊØèÂÄãÂÄºÈÉΩÊòØÂêàÊ≥ïÁöÑÊúâÈôêÈùûË≤†Êï∏Ôºå‰∏îÂú®ÂêàÁêÜ‰∏äÈôêÂÖß
function loadInventory() {
  const defaults = {
    '9Ê®ì':    { '500ml': 4.5, '1000ml': 2, '2000ml': 7 },
    '13Ê®ì':   { '500ml': 10,  '1000ml': 5, '2000ml': 3 },
    'ÊÉÖ‰∫∫Êπñ': { '500ml': 9,   '1000ml': 3, '2000ml': 4 },
  };
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const parsed = JSON.parse(saved);
      const validated = {};
      LOCATIONS.forEach(loc => {
        validated[loc] = {};
        PRODUCTS.forEach(p => {
          const raw = parsed?.[loc]?.[p.id];
          const val = parseFloat(raw);
          // ÂøÖÈ†àÊòØÊúâÈôêÊï∏„ÄÅÈùûË≤†„ÄÅ‰∏çË∂ÖÈÅé 9999ÔºåÂê¶ÂâáÊ≠∏Èõ∂
          validated[loc][p.id] = (isFinite(val) && val >= 0 && val <= 9999) ? val : 0;
        });
      });
      return validated;
    }
  } catch(e) {
    // JSON Ëß£ÊûêÂ§±ÊïóÊôÇ‰ΩøÁî®È†êË®≠ÂÄº
  }
  return defaults;
}

function saveInventory() {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(inventory)); } catch(e) {}
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function renderTabs() {
  const el = document.getElementById('tabs');
  el.innerHTML = LOCATIONS.map(loc => `
    <button class="tab-btn ${loc === activeTab ? 'active' : ''}" onclick="switchTab('${loc}')">${loc}</button>
  `).join('');
}

function renderProducts() {
  document.getElementById('editorTitle').textContent = `Ê≠£Âú®Áõ§ÈªûÔºö${activeTab}`;
  const el = document.getElementById('productList');
  el.innerHTML = PRODUCTS.map((p, i) => `
    <div class="product-row ${p.color}">
      <div class="product-num">${i+1}</div>
      <div class="product-visual">${svgs[p.id]}</div>
      <div class="product-info">
        <div class="product-brand">${p.brand}</div>
        <div class="product-name">${p.name}</div>
        <div class="product-unit">UNIT / ÁÆ±</div>
      </div>
      <div class="stepper">
        <button class="stepper-btn minus" onclick="adjust('${p.id}', -0.5)">‚àí</button>
        <div class="stepper-divider"></div>
        <input
          class="stepper-input"
          type="number" step="0.5" min="0" max="9999"
          value="${inventory[activeTab][p.id]}"
          onchange="handleInput('${p.id}', this.value)"
          oninput="handleInput('${p.id}', this.value)"
        >
        <div class="stepper-divider"></div>
        <button class="stepper-btn plus" onclick="adjust('${p.id}', 0.5)">+</button>
      </div>
    </div>
  `).join('');
  // ‚úÖ value="${...}" Â°´ÂÖ•ÁöÑÂÄºÂ∑≤Âú® loadInventory È©óË≠âÁÇ∫ÂêàÊ≥ïÊï∏Â≠óÔºåÁÑ°Ê≥®ÂÖ•È¢®Èö™
}

function renderTable() {
  const totals = {};
  PRODUCTS.forEach(p => { totals[p.id] = 0; });
  LOCATIONS.forEach(loc => {
    PRODUCTS.forEach(p => { totals[p.id] += (inventory[loc][p.id] || 0); });
  });

  const el = document.getElementById('summaryTable');
  el.innerHTML = `
    <thead>
      <tr>
        <th>ÂìÅÈ†Ö</th>
        ${LOCATIONS.map(l => `<th>${l}</th>`).join('')}
        <th style="color:var(--accent)">Á∏ΩË®à</th>
      </tr>
    </thead>
    <tbody>
      ${PRODUCTS.map(p => `
        <tr>
          <td>${p.name}</td>
          ${LOCATIONS.map(l => `<td>${inventory[l][p.id]}</td>`).join('')}
          <td class="td-total">${totals[p.id]}</td>
        </tr>
      `).join('')}
    </tbody>
  `;
  // ‚úÖ inventory ÂÄºÂ∑≤Âú® loadInventory È©óË≠âÁÇ∫Êï∏Â≠óÔºåtd ÊèíÂÖ•ÂÆâÂÖ®
}

function render() {
  renderTabs();
  renderProducts();
  renderTable();
}

// ‚îÄ‚îÄ Actions ‚îÄ‚îÄ
function switchTab(loc) {
  activeTab = loc;
  render();
}

function adjust(productId, delta) {
  let val = (inventory[activeTab][productId] || 0) + delta;
  if (val < 0) val = 0;
  if (val > 9999) val = 9999; // ‚úÖ [‰øÆÊ≠£4] ÂêåÊ≠•Âä†‰∏ä‰∏äÈôê‰øùË≠∑
  inventory[activeTab][productId] = val;
  saveInventory();
  render();
}

// ‚úÖ [‰øÆÊ≠£4] handleInputÔºöÂä†ÂÖ•‰∏äÈôê 9999 È©óË≠â
function handleInput(productId, value) {
  let val = parseFloat(value);
  if (isNaN(val) || val < 0) val = 0;
  if (val > 9999) val = 9999;
  inventory[activeTab][productId] = val;
  saveInventory();
  renderTable();
}

function handleSave() {
  saveInventory();
  showToast('‚úÖ Â∑≤ÂÑ≤Â≠òËá≥Êú¨Ê©ü');
}

// ‚úÖ [‰øÆÊ≠£5] ÁßªÈô§Â∑≤Âª¢Ê£ÑÁöÑ document.execCommand('copy')ÔºåÂÉÖ‰ΩøÁî®Áèæ‰ª£ Clipboard API
function handleExport() {
  const lines = PRODUCTS.map((p, i) =>
    `${i+1}. ${p.name}Ôºö${inventory[activeTab][p.id]} ÁÆ±`
  );
  const now = new Date();
  const dateStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
  const text = `„Äê${activeTab} Â∫´Â≠òÂõûÂ†±„Äë${dateStr}

${lines.join('
')}`;

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text)
      .then(() => showToast(`üìã Â∑≤Ë§áË£Ω„Äå${activeTab}„ÄçÂõûÂ†±Êñá`))
      .catch(() => showToast('‚ö†Ô∏è Ë§áË£ΩÂ§±ÊïóÔºåË´ãÁ¢∫Ë™çÁÄèË¶ΩÂô®Ê¨äÈôê'));
  } else {
    // ‰∏çÊîØÊè¥ Clipboard APIÔºàÂ¶ÇËàäÁâà HTTP Áí∞Â¢ÉÔºâÔºåÊèêÁ§∫ÊîπÁî® HTTPS
    showToast('‚ö†Ô∏è Ë´ãÂú® HTTPS Áí∞Â¢É‰∏ã‰ΩøÁî®Ê≠§ÂäüËÉΩ');
  }
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
let toastTimer;
function showToast(msg) {
  const el = document.getElementById('toast');
  const msgEl = document.getElementById('toastMsg');
  msgEl.textContent = msg; // ‚úÖ textContentÔºåÈùû innerHTMLÔºåÂÆâÂÖ®
  el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 2800);
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
render();
</script>
</body>
</html>
