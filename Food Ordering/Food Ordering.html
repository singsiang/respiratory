<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ˜è³¼é»é¤å°å¹«æ‰‹</title>
  
  <!-- è¼‰å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- è¼‰å…¥ React èˆ‡ ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- è¼‰å…¥ Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- è‡ªè¨‚æ²è»¸æ¨£å¼ -->
  <style>
    body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const DRINK_SUGAR = ['æ­£å¸¸ç³–', 'å°‘ç³–', 'åŠç³–', 'å¾®ç³–', 'ä¸€åˆ†ç³–', 'ç„¡ç³–'];
    const DRINK_ICE = ['æ­£å¸¸å†°', 'å°‘å†°', 'å¾®å†°', 'å»å†°', 'å®Œå…¨å»å†°', 'å¸¸æº«', 'ç†±'];
    const DRINK_SIZE = ['å¤§æ¯', 'ä¸­æ¯'];

    const Icons = {
      Utensils: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
      Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="2" x2="6" y2="4"/><line x1="10" y1="2" x2="10" y2="4"/><line x1="14" y1="2" x2="14" y2="4"/></svg>,
      Clipboard: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>,
      Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
      MessageSquare: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
      Info: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>,
      EyeOff: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" y1="2" x2="22" y2="22"/></svg>,
      Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
      Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>,
      X: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    };

    const generateId = () => Math.random().toString(36).substring(2, 11);

    function App() {
      const [orders, setOrders] = useState([]);
      const [activeTab, setActiveTab] = useState('import'); // é è¨­æ‰“é–‹åŒ¯å…¥é é¢æ–¹ä¾¿æ¸¬è©¦
      const [toastMsg, setToastMsg] = useState('');
      
      const [isAnonymous, setIsAnonymous] = useState(false);

      const [formType, setFormType] = useState('food');
      const [person, setPerson] = useState('');
      const [itemName, setItemName] = useState('');
      const [price, setPrice] = useState('');
      const [sugar, setSugar] = useState('åŠç³–');
      const [ice, setIce] = useState('å¾®å†°');
      const [size, setSize] = useState('å¤§æ¯');

      const [importText, setImportText] = useState('');

      const [editingId, setEditingId] = useState(null);
      const [editForm, setEditForm] = useState({ person: '', itemName: '', price: '', type: 'food', size: '', sugar: '', ice: '' });

      useEffect(() => {
        const savedOrders = localStorage.getItem('groupOrdersData');
        if (savedOrders) {
          try {
            setOrders(JSON.parse(savedOrders));
          } catch (e) {}
        }
      }, []);

      useEffect(() => {
        localStorage.setItem('groupOrdersData', JSON.stringify(orders));
      }, [orders]);

      const showToast = (msg) => {
        setToastMsg(msg);
        setTimeout(() => setToastMsg(''), 3000);
      };

      const copyToClipboard = (text) => {
        try {
          if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text);
            showToast('âœ… çµ±è¨ˆæ–‡å­—å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
          } else {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            document.execCommand('copy');
            textArea.remove();
            showToast('âœ… çµ±è¨ˆæ–‡å­—å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
          }
        } catch (err) {
          showToast('âŒ è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•å…¨é¸æ–‡å­—è¤‡è£½ã€‚');
        }
      };

      const maskName = (name) => {
        if (!name) return '';
        const len = name.length;
        if (len === 1) return name; 
        if (len === 2) return name.charAt(0) + 'â—‹'; 
        if (len === 3) return name.charAt(0) + 'â—‹' + name.charAt(2); 
        return name.charAt(0) + 'â—‹'.repeat(len - 2) + name.charAt(len - 1);
      };

      const handleAddOrder = (e) => {
        e.preventDefault();
        if (!person.trim() || !itemName.trim()) {
          showToast('âš ï¸ è«‹å¡«å¯«è¨‚è³¼äººèˆ‡å“é …åç¨±');
          return;
        }

        const newOrder = {
          id: generateId(),
          type: formType,
          person: person.trim(),
          itemName: itemName.trim(),
          price: parseInt(price) || 0,
          sugar: formType === 'drink' ? sugar : null,
          ice: formType === 'drink' ? ice : null,
          size: formType === 'drink' ? size : null,
        };

        setOrders([...orders, newOrder]);
        showToast(`å·²æ–°å¢ ${person} çš„ ${itemName}`);
        setPerson('');
      };

      const handleDelete = (id) => {
        setOrders(orders.filter(o => o.id !== id));
      };

      const handleEditClick = (order) => {
        setEditingId(order.id);
        setEditForm({
          person: order.person,
          itemName: order.itemName,
          price: order.price === 0 ? '' : order.price,
          type: order.type || 'food',
          size: order.size || '',
          sugar: order.sugar || '',
          ice: order.ice || ''
        });
      };

      const handleSaveEdit = (id) => {
        setOrders(orders.map(o => {
          if (o.id === id) {
            return {
              ...o,
              person: editForm.person.trim() || o.person,
              itemName: editForm.itemName.trim() || o.itemName,
              price: parseInt(editForm.price) || 0,
              type: editForm.type,
              size: editForm.type === 'drink' ? editForm.size.trim() : null,
              sugar: editForm.type === 'drink' ? editForm.sugar.trim() : null,
              ice: editForm.type === 'drink' ? editForm.ice.trim() : null,
            };
          }
          return o;
        }));
        setEditingId(null);
        showToast('âœ… è¨‚å–®å·²æ›´æ–°');
      };

      const handleCancelEdit = () => {
        setEditingId(null);
      };

      const handleClearAll = () => {
        if(orders.length === 0) return;
        setOrders([]);
        showToast('ğŸ—‘ï¸ å·²æ¸…ç©ºæ‰€æœ‰è¨‚å–®');
      };

      // æ™ºæ…§éæ¿¾ï¼šå»é™¤ LINE ä¸Šå¸¸è¦‹çš„ç¦®è²Œç”¨èª
      const cleanItemString = (str) => {
        return str.replace(/(?:è¬è¬|æ„Ÿè¬|æ„Ÿæ©|éº»ç…©äº†|è¾›è‹¦äº†).*$/, '').trim();
      };

      const handleImportText = () => {
        if (!importText.trim()) return;

        const lines = importText.split('\n');
        let currentPerson = '';
        const newOrders = [];
        let importCount = 0;

        lines.forEach(line => {
          const trimmed = line.trim();
          if (!trimmed || trimmed.includes('ä»Šæ—¥ä¾¿ç•¶') || trimmed.includes('ä»Šæ—¥é£²æ–™')) return;

          // åˆ¤æ–·æ˜¯å¦ç‚ºå‰æ–¹æœ‰ç¸®æ’çš„ã€Œé€£çºŒé»é¤ã€(ç”¨ä¾†åˆ¤æ–·åŒä¸€å€‹äººçš„ç¬¬äºŒæ¨£)
          // åµæ¸¬é–‹é ­æ˜¯å¦æœ‰å…©å€‹ä»¥ä¸Šçš„åŠå½¢ç©ºç™½ï¼Œæˆ–æ˜¯æœ‰å…¨å½¢ç©ºç™½
          const isIndented = /^[ \t]{2,}/.test(line) || /^\u3000+/.test(line);

          // 1. å„ªå…ˆå˜—è©¦ã€Œå†’è™Ÿã€æ ¼å¼è§£æ (ç‹å°æ˜ï¼šè„†çš®é´¨è‚‰)
          let match = trimmed.match(/^([^ï¼š:]+)[ï¼š:](.+)$/);
          
          // 2. å¦‚æœæ²’æœ‰å†’è™Ÿï¼Œä¸”ã€Œä¸æ˜¯ç¸®æ’ã€ï¼Œå‰‡å˜—è©¦ã€Œç©ºæ ¼ã€æ ¼å¼è§£æ (ç‹å°æ˜ è„†çš®é´¨è‚‰)
          if (!match && !isIndented) {
             // å‡è¨­ç¬¬ä¸€å€‹è©æ˜¯åå­— (é™åˆ¶10å­—ä»¥å…§é¿å…èª¤åˆ¤)ï¼Œå¾Œé¢å…¨æ˜¯å“é …
             match = trimmed.match(/^(\S{1,10})\s+(.+)$/);
          }
          
          if (match && !isIndented) {
            // æ‰¾åˆ°æ–°çš„äººåèˆ‡å“é …
            currentPerson = match[1].trim();
            let item = match[2].trim();
            item = cleanItemString(item); // æ¿¾é™¤è¬è¬ç­‰å­—çœ¼

            if (item) {
              newOrders.push({
                id: generateId(),
                type: 'food', 
                person: currentPerson,
                itemName: item,
                price: 0
              });
              importCount++;
            }
          } else {
            // æ˜¯é€£çºŒé»é¤é …ç›®ï¼Œæ­¸çµ¦ä¸Šä¸€å€‹äºº
            if (currentPerson && trimmed.length > 0) {
              let item = cleanItemString(trimmed); // æ¿¾é™¤è¬è¬ç­‰å­—çœ¼
              if(item) {
                newOrders.push({
                  id: generateId(),
                  type: 'food',
                  person: currentPerson,
                  itemName: item,
                  price: 0
                });
                importCount++;
              }
            }
          }
        });

        if (importCount > 0) {
          setOrders([...orders, ...newOrders]);
          setImportText('');
          showToast(`âœ… æˆåŠŸåŒ¯å…¥ ${importCount} ç­†è¨‚å–®ï¼(å·²è‡ªå‹•å»é™¤æ„Ÿè¬ç”¨èª)`);
        } else {
          showToast('âš ï¸ æ‰¾ä¸åˆ°ç¬¦åˆæ ¼å¼çš„è³‡æ–™ï¼Œè«‹ç¢ºèªæ¯è¡Œæœ‰ã€Œå§“åã€åŠã€Œå“é …ã€ã€‚');
        }
      };

      const generateStats = () => {
        const summary = {};
        let totalPrice = 0;

        orders.forEach(order => {
          totalPrice += order.price;
          
          let displayItemName = order.itemName;
          if (order.type === 'drink' && (order.size || order.sugar || order.ice)) {
            const details = [order.size, order.sugar, order.ice].filter(Boolean).join('/');
            if(details) displayItemName = `${order.itemName} (${details})`;
          }

          if (!summary[displayItemName]) {
            summary[displayItemName] = { count: 0, people: [], type: order.type };
          }
          summary[displayItemName].count += 1;
          
          const displayName = isAnonymous ? maskName(order.person) : order.person;
          summary[displayItemName].people.push(displayName);
        });

        return { summary, totalPrice };
      };

      const getExportText = () => {
        const { summary, totalPrice } = generateStats();
        let text = `ã€ä»Šæ—¥è¨‚é¤çµ±è¨ˆã€‘\n`;
        text += `ç¸½ä»½æ•¸ï¼š${orders.length} ä»½\n`;
        if (totalPrice > 0) text += `ç¸½é‡‘é¡ï¼š$${totalPrice} å…ƒ\n`;
        text += `\n--- ğŸ“Š çµ±è¨ˆæ¸…å–® (æ–¹ä¾¿é»é¤) ---\n`;
        
        Object.entries(summary).forEach(([itemName, data]) => {
          text += `â–ª ${itemName} x ${data.count}\n`;
          text += `  â”” ${data.people.join(', ')}\n`;
        });

        text += `\n--- ğŸ‘¤ å€‹äººæ˜ç´° (æ–¹ä¾¿ç™¼é¤) ---\n`;
        
        const personMap = {};
        orders.forEach(o => {
          const pName = isAnonymous ? maskName(o.person) : o.person;
          if (!personMap[pName]) personMap[pName] = { total: 0, items: [] };
          personMap[pName].total += o.price;
          
          let name = o.itemName;
          if (o.type === 'drink' && (o.size || o.sugar || o.ice)) {
            const details = [o.size, o.sugar, o.ice].filter(Boolean).join('/');
            if(details) name += `(${details})`;
          }
          personMap[pName].items.push(name);
        });

        Object.entries(personMap).forEach(([person, data]) => {
          text += `[${person}] ${data.items.join('ã€')}`;
          if (data.total > 0) text += ` ($${data.total})`;
          text += `\n`;
        });

        return text;
      };

      return (
        <div className="min-h-screen p-4 md:p-8">
          {toastMsg && (
            <div className="fixed top-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg z-50 flex items-center space-x-2 transition-all duration-300">
              <Icons.Info />
              <span>{toastMsg}</span>
            </div>
          )}

          <div className="max-w-5xl mx-auto space-y-6">
            <div className="text-center space-y-2">
              <h1 className="text-3xl font-extrabold text-slate-800 tracking-tight flex justify-center items-center gap-2">
                ğŸ± åœ˜è³¼é»é¤å°å¹«æ‰‹ ğŸ¥¤
              </h1>
              <p className="text-slate-500 text-sm">æ”¯æ´ LINE ç©ºæ ¼ã€å†’è™Ÿæ··æ’æ™ºæ…§åŒ¯å…¥</p>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
              
              <div className="lg:col-span-5 space-y-4">
                <div className="flex bg-white rounded-xl shadow-sm border border-slate-200 p-1">
                  <button
                    onClick={() => setActiveTab('import')}
                    className={`flex-1 flex justify-center items-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-colors ${activeTab === 'import' ? 'bg-indigo-50 text-indigo-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                  >
                    <Icons.MessageSquare /> æ–‡å­—åŒ¯å…¥
                  </button>
                  <button
                    onClick={() => setActiveTab('manual')}
                    className={`flex-1 flex justify-center items-center gap-2 py-2.5 text-sm font-medium rounded-lg transition-colors ${activeTab === 'manual' ? 'bg-indigo-50 text-indigo-700 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                  >
                    <Icons.Utensils /> æ‰‹å‹•æ–°å¢
                  </button>
                </div>

                {activeTab === 'manual' && (
                  <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-5">
                    <form onSubmit={handleAddOrder} className="space-y-4">
                      <div className="flex gap-4 mb-2">
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input type="radio" checked={formType === 'food'} onChange={() => setFormType('food')} className="text-indigo-600 focus:ring-indigo-500" />
                          <span className="font-medium text-slate-700 flex items-center gap-1"><Icons.Utensils /> ä¾¿ç•¶/é£Ÿç‰©</span>
                        </label>
                        <label className="flex items-center gap-2 cursor-pointer">
                          <input type="radio" checked={formType === 'drink'} onChange={() => setFormType('drink')} className="text-indigo-600 focus:ring-indigo-500" />
                          <span className="font-medium text-slate-700 flex items-center gap-1"><Icons.Coffee /> é£²æ–™</span>
                        </label>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-1">
                          <label className="text-xs font-semibold text-slate-500 uppercase">è¨‚è³¼äºº</label>
                          <input type="text" value={person} onChange={(e) => setPerson(e.target.value)} placeholder="å¦‚ï¼šç‹å°æ˜" className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                        </div>
                        <div className="space-y-1">
                          <label className="text-xs font-semibold text-slate-500 uppercase">åƒ¹æ ¼ (å…ƒ)</label>
                          <input type="number" value={price} onChange={(e) => setPrice(e.target.value)} placeholder="å¦‚ï¼š60" className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                        </div>
                      </div>

                      <div className="space-y-1">
                        <label className="text-xs font-semibold text-slate-500 uppercase">å“é …åç¨±</label>
                        <input type="text" value={itemName} onChange={(e) => setItemName(e.target.value)} placeholder={formType === 'drink' ? 'å¦‚ï¼šèŠ’æœæœç²’æ³¢æ³¢' : 'å¦‚ï¼šè„†çš®é´¨è‚‰'} className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                      </div>

                      {formType === 'drink' && (
                        <div className="bg-slate-50 p-4 rounded-xl border border-slate-100 space-y-3">
                          <div className="flex flex-wrap gap-2">
                            <span className="text-xs font-semibold text-slate-500 uppercase w-full">å®¹é‡</span>
                            {DRINK_SIZE.map(s => (
                              <button key={s} type="button" onClick={() => setSize(s)} className={`px-3 py-1 text-sm rounded-full border transition-colors ${size === s ? 'bg-blue-100 border-blue-300 text-blue-800' : 'bg-white border-slate-200 text-slate-600'}`}>{s}</button>
                            ))}
                          </div>
                          <div className="flex flex-wrap gap-2">
                            <span className="text-xs font-semibold text-slate-500 uppercase w-full">ç”œåº¦</span>
                            {DRINK_SUGAR.map(s => (
                              <button key={s} type="button" onClick={() => setSugar(s)} className={`px-3 py-1 text-sm rounded-full border transition-colors ${sugar === s ? 'bg-amber-100 border-amber-300 text-amber-800' : 'bg-white border-slate-200 text-slate-600'}`}>{s}</button>
                            ))}
                          </div>
                          <div className="flex flex-wrap gap-2">
                            <span className="text-xs font-semibold text-slate-500 uppercase w-full">å†°å¡Š</span>
                            {DRINK_ICE.map(i => (
                              <button key={i} type="button" onClick={() => setIce(i)} className={`px-3 py-1 text-sm rounded-full border transition-colors ${ice === i ? 'bg-cyan-100 border-cyan-300 text-cyan-800' : 'bg-white border-slate-200 text-slate-600'}`}>{i}</button>
                            ))}
                          </div>
                        </div>
                      )}

                      <button type="submit" className="w-full bg-indigo-600 text-white font-semibold py-2.5 rounded-xl hover:bg-indigo-700 active:bg-indigo-800 transition-colors shadow-sm">
                        æ–°å¢è‡³æ¸…å–®
                      </button>
                    </form>
                  </div>
                )}

                {activeTab === 'import' && (
                  <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 space-y-4">
                    <div className="bg-amber-50 text-amber-800 p-3 rounded-lg text-sm border border-amber-200">
                      <p className="font-semibold mb-1">ğŸ’¡ å…¨æ–°å‡ç´šï¼šæ”¯æ´ç©ºæ ¼èˆ‡è‡ªå‹•éæ¿¾</p>
                      <p className="text-xs">ä½ ç¾åœ¨å¯ä»¥ç›´æ¥è²¼ä¸Šåƒã€Œ<strong className="text-amber-900">è²è²å½¬ èŠ’æœæœç²’æ³¢æ³¢ è¬è¬ (æ„Ÿè¬)</strong>ã€é€™æ¨£çš„æ–‡å­—ï¼Œç³»çµ±æœƒè‡ªå‹•è¾¨è­˜ä¸¦å¹«ä½ éæ¿¾æ‰ã€Œè¬è¬ã€ï¼</p>
                    </div>
                    <textarea 
                      value={importText}
                      onChange={(e) => setImportText(e.target.value)}
                      placeholder="è²¼ä¸Šæ–‡å­—ç¯„ä¾‹ï¼š&#10;è²è²å½¬ èŠ’æœæœç²’æ³¢æ³¢ è¬è¬ (æ„Ÿè¬)&#10;æ—å°å®‰ è„†çš®é´¨è‚‰"
                      className="w-full h-48 px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all resize-none font-mono text-sm"
                    />
                    <button 
                      onClick={handleImportText}
                      className="w-full bg-indigo-600 text-white font-semibold py-2.5 rounded-xl hover:bg-indigo-700 active:bg-indigo-800 transition-colors shadow-sm flex justify-center items-center gap-2"
                    >
                      <Icons.MessageSquare /> é–‹å§‹æ™ºæ…§è§£æèˆ‡åŒ¯å…¥
                    </button>
                  </div>
                )}
              </div>

              <div className="lg:col-span-7 space-y-4">
                
                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-5">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="font-bold text-slate-800 flex items-center gap-2">
                      <Icons.Utensils /> å¾Œå°çœŸå¯¦è¨‚è³¼æ¸…å–® 
                      <span className="bg-indigo-100 text-indigo-700 text-xs py-0.5 px-2 rounded-full">{orders.length} ç­†</span>
                    </h3>
                    {orders.length > 0 && (
                      <button onClick={handleClearAll} className="text-red-500 text-sm hover:text-red-700 font-medium flex items-center gap-1">
                        <Icons.Trash2 /> æ¸…ç©ºæ‰€æœ‰
                      </button>
                    )}
                  </div>
                  
                  <div className="max-h-64 overflow-y-auto space-y-2 pr-2 custom-scrollbar">
                    {orders.length === 0 ? (
                      <div className="text-center text-slate-400 py-10 flex flex-col items-center gap-2">
                        <Icons.Clipboard />
                        <p className="text-sm">å°šæœªæ–°å¢ä»»ä½•å“é …</p>
                      </div>
                    ) : (
                      orders.map(o => (
                        <div key={o.id} className="flex justify-between items-center bg-slate-50 p-3 rounded-xl border border-slate-100 text-sm hover:border-slate-200 transition-colors">
                          {editingId === o.id ? (
                            <div className="flex-1 flex flex-col gap-2 w-full">
                              <div className="flex flex-col sm:flex-row gap-2 items-start sm:items-center w-full">
                                <select
                                  value={editForm.type}
                                  onChange={(e) => setEditForm({...editForm, type: e.target.value})}
                                  className="px-2 py-1.5 border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-white text-slate-700"
                                >
                                  <option value="food">ğŸ±ä¾¿ç•¶</option>
                                  <option value="drink">ğŸ¥¤é£²æ–™</option>
                                </select>
                                <input
                                  type="text"
                                  value={editForm.person}
                                  onChange={(e) => setEditForm({...editForm, person: e.target.value})}
                                  className="w-full sm:w-20 px-2 py-1.5 border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                  placeholder="å§“å"
                                />
                                <input
                                  type="text"
                                  value={editForm.itemName}
                                  onChange={(e) => setEditForm({...editForm, itemName: e.target.value})}
                                  className="flex-1 w-full px-2 py-1.5 border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                  placeholder="å“é …"
                                />
                                <div className="flex items-center gap-2 w-full sm:w-auto">
                                  <span className="text-slate-500 hidden sm:inline">$</span>
                                  <input
                                    type="number"
                                    value={editForm.price}
                                    onChange={(e) => setEditForm({...editForm, price: e.target.value})}
                                    className="w-16 px-2 py-1.5 border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                    placeholder="åƒ¹æ ¼"
                                  />
                                  <div className="flex gap-1 ml-auto sm:ml-2">
                                    <button onClick={() => handleSaveEdit(o.id)} className="p-1.5 text-green-600 hover:bg-green-100 rounded-lg transition-colors bg-green-50" title="å„²å­˜">
                                      <Icons.Check />
                                    </button>
                                    <button onClick={handleCancelEdit} className="p-1.5 text-slate-400 hover:bg-slate-200 hover:text-slate-600 rounded-lg transition-colors bg-slate-100" title="å–æ¶ˆ">
                                      <Icons.X />
                                    </button>
                                  </div>
                                </div>
                              </div>
                              {editForm.type === 'drink' && (
                                <div className="flex flex-wrap gap-2 items-center pl-1 mt-1">
                                  <input
                                    type="text"
                                    list="size-options"
                                    value={editForm.size}
                                    onChange={(e) => setEditForm({...editForm, size: e.target.value})}
                                    className="w-24 px-2 py-1.5 text-sm border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                    placeholder="å®¹é‡(å¦‚:å¤§æ¯)"
                                  />
                                  <input
                                    type="text"
                                    list="sugar-options"
                                    value={editForm.sugar}
                                    onChange={(e) => setEditForm({...editForm, sugar: e.target.value})}
                                    className="w-24 px-2 py-1.5 text-sm border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                    placeholder="ç”œåº¦(å¦‚:åŠç³–)"
                                  />
                                  <input
                                    type="text"
                                    list="ice-options"
                                    value={editForm.ice}
                                    onChange={(e) => setEditForm({...editForm, ice: e.target.value})}
                                    className="w-24 px-2 py-1.5 text-sm border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                    placeholder="å†°å¡Š(å¦‚:å»å†°)"
                                  />
                                </div>
                              )}
                            </div>
                          ) : (
                            <>
                              <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold">
                                  {o.person.substring(0, 1)}
                                </div>
                                <div>
                                  <div className="font-bold text-slate-800">{o.person}</div>
                                  <div className="text-slate-600 flex items-center gap-1">
                                    {o.type === 'drink' ? <Icons.Coffee /> : <Icons.Utensils />}
                                    {o.itemName}
                                    {o.type === 'drink' && (o.size || o.sugar || o.ice) && <span className="text-xs text-slate-400">({[o.size, o.sugar, o.ice].filter(Boolean).join('/')})</span>}
                                  </div>
                                </div>
                              </div>
                              <div className="flex items-center gap-2">
                                {o.price > 0 && <span className="font-semibold text-slate-700 mr-2">${o.price}</span>}
                                <button onClick={() => handleEditClick(o)} className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors" title="ç·¨è¼¯">
                                  <Icons.Edit />
                                </button>
                                <button onClick={() => handleDelete(o.id)} className="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors" title="åˆªé™¤">
                                  <Icons.Trash2 />
                                </button>
                              </div>
                            </>
                          )}
                        </div>
                      ))
                    )}
                  </div>
                </div>

                <div className="bg-indigo-600 rounded-2xl shadow-md p-5 text-white">
                  <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-3">
                    <h3 className="font-bold text-lg flex items-center gap-2">
                      <Icons.Clipboard /> è¼¸å‡ºèˆ‡åˆ†äº«
                    </h3>
                    
                    <div className="flex flex-wrap items-center gap-3">
                      <label className="flex items-center gap-2 cursor-pointer bg-indigo-700/50 px-3 py-1.5 rounded-lg border border-indigo-400/30 hover:bg-indigo-700 transition-colors">
                        <input 
                          type="checkbox" 
                          checked={isAnonymous} 
                          onChange={(e) => setIsAnonymous(e.target.checked)} 
                          className="rounded border-indigo-300 text-indigo-500 focus:ring-indigo-400 w-4 h-4 cursor-pointer"
                        />
                        <span className="text-sm font-medium flex items-center gap-1">
                          <Icons.EyeOff /> å§“åå»è­˜åˆ¥åŒ–
                        </span>
                      </label>

                      <button 
                        onClick={() => copyToClipboard(getExportText())}
                        disabled={orders.length === 0}
                        className="bg-white text-indigo-700 px-4 py-1.5 rounded-lg text-sm font-bold shadow-sm hover:bg-indigo-50 active:bg-slate-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                      >
                        <Icons.Clipboard /> è¤‡è£½åˆ†äº«åˆ°..
                      </button>
                    </div>
                  </div>

                  <div className="bg-indigo-900/40 rounded-xl p-4 font-mono text-sm whitespace-pre-wrap overflow-y-auto max-h-96 text-indigo-100 border border-indigo-500/30">
                    {orders.length === 0 ? (
                      <span className="opacity-50">æ–°å¢è¨‚å–®å¾Œï¼Œçµ±è¨ˆæ–‡å­—æœƒé¡¯ç¤ºåœ¨é€™è£¡ã€‚</span>
                    ) : (
                      getExportText()
                    )}
                  </div>
                </div>

              </div>
            </div>
            
            {/* éš±è—çš„é¸é …æ¸…å–®ï¼Œæä¾›çµ¦ä¿®æ”¹é£²æ–™æ™‚çš„è‡ªå‹•æç¤º */}
            <datalist id="size-options">
              {DRINK_SIZE.map(s => <option key={s} value={s} />)}
            </datalist>
            <datalist id="sugar-options">
              {DRINK_SUGAR.map(s => <option key={s} value={s} />)}
            </datalist>
            <datalist id="ice-options">
              {DRINK_ICE.map(i => <option key={i} value={i} />)}
            </datalist>

          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>






