<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«æ¨‚æ‰“å­—å“¡ - å°æœ‹å‹çš„æ‰“é›»è…¦éŠæˆ²</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; overflow: hidden; user-select: none; background-color: #f0f9ff; }
        .key-active { transform: translateY(4px); background-color: #fbbf24 !important; border-bottom-width: 0px !important; }
        .shake { animation: shake 0.3s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        canvas { display: block; max-width: 100%; max-height: 400px; border-radius: 20px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const SvgIcon = ({ name, className = "w-6 h-6" }) => {
            const icons = {
                keyboard: <path d="M20 5H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V7a2 2 0 00-2-2zM7 8h2v2H7V8zm0 4h2v2H7v-2zm4-4h2v2h-2V8zm0 4h2v2h-2v-2zm4-4h2v2h-2V8zm0 4h2v2h-2v-2zM4 17V7h16v10H4z" />,
                trophy: <path d="M8 2v2H5a2 2 0 00-2 2v2c0 1.1.9 2 2 2h2a4 4 0 004 4v2H9v4h6v-4h-2v-2a4 4 0 004-4h2a2 2 0 002-2V6a2 2 0 00-2-2h-3V2H8zm0 2h8v2H8V4zM5 6h3v4H5V6zm11 0h3v4h-3V6z" />,
                sparkles: <path d="M5 3L4 6L1 7L4 8L5 11L6 8L9 7L6 6L5 3zM19 13L18 16L15 17L18 18L19 21L20 18L23 17L20 16L19 13zM14 4L12.5 8.5L8 10L12.5 11.5L14 16L15.5 11.5L20 10L15.5 8.5L14 4z" />,
                home: <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />,
                bird: <path d="M12 21c-4.418 0-8-3.582-8-8 0-4.418 3.582-8 8-8s8 3.582 8 8c0 4.418-3.582 8-8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm1-7h2v2h-2v-2zm-4 0h2v2H9v-2z" />
            };
            return (
                <svg className={className} fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    {icons[name]}
                </svg>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('menu');
            const [currentKey, setCurrentKey] = useState(null);
            const [targetKey, setTargetKey] = useState(null);
            const [score, setScore] = useState(0);
            const [streak, setStreak] = useState(0);
            const [feedback, setFeedback] = useState(null);
            const [displayKey, setDisplayKey] = useState({ char: '', color: 'text-blue-500' });
            
            // éŠæˆ²ç‰©ç† (Happy Bird)
            const [birdPos, setBirdPos] = useState({ y: 200, velocity: 0 });
            const [pipes, setPipes] = useState([]);
            const [gameStatus, setGameStatus] = useState('waiting'); // waiting, playing, gameOver
            const gameLoopRef = useRef();
            const canvasRef = useRef();
            const audioCtx = useRef(null);

            const initAudio = () => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                }
            };

            const playSound = (type, pitch = 1) => {
                if (!audioCtx.current) return;
                const ctx = audioCtx.current;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                const now = ctx.currentTime;

                if (type === 'flap') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(150 * pitch, now);
                    osc.frequency.exponentialRampToValueAtTime(400 * pitch, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.1);
                    osc.start(); osc.stop(now + 0.1);
                } else if (type === 'score') {
                    osc.frequency.setValueAtTime(600 * pitch, now);
                    osc.frequency.setValueAtTime(800 * pitch, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.3);
                    osc.start(); osc.stop(now + 0.3);
                } else if (type === 'hit') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start(); osc.stop(now + 0.5);
                } else if (type === 'correct') {
                    osc.frequency.setValueAtTime(500, now);
                    osc.frequency.setValueAtTime(700, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    osc.start(); osc.stop(now + 0.2);
                }
            };

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const msg = new SpeechSynthesisUtterance(text);
                    msg.lang = 'en-US';
                    window.speechSynthesis.speak(msg);
                }
            };

            const handleAction = (key) => {
                initAudio();
                const k = key.toUpperCase();
                setCurrentKey(k);
                setTimeout(() => setCurrentKey(null), 100);

                if (mode === 'free') {
                    if (k.length === 1) {
                        setDisplayKey({ char: k, color: 'text-blue-500' });
                        playSound('flap', 1.5);
                        speak(k);
                    }
                } else if (mode === 'challenge') {
                    if (k === targetKey) {
                        setScore(s => s + 10);
                        setFeedback('correct');
                        playSound('score');
                        setTimeout(() => {
                            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
                            const next = chars[Math.floor(Math.random() * chars.length)];
                            setTargetKey(next);
                            setFeedback(null);
                            speak(next);
                        }, 800);
                    } else if (k.length === 1) {
                        setFeedback('wrong');
                        playSound('hit');
                    }
                } else if (mode === 'bird') {
                    if (gameStatus === 'waiting') {
                        setGameStatus('playing');
                        setScore(0);
                        setPipes([{ x: 600, gapTop: 150 }]);
                    }
                    if (gameStatus === 'playing' && k.length === 1) {
                        setBirdPos(prev => ({ ...prev, velocity: -7 }));
                        setDisplayKey({ char: k, color: 'text-white' });
                        playSound('flap');
                    }
                    if (gameStatus === 'gameOver') {
                        setGameStatus('waiting');
                        setBirdPos({ y: 200, velocity: 0 });
                        setPipes([]);
                    }
                }
            };

            // Happy Bird éŠæˆ²å¾ªç’°
            useEffect(() => {
                if (mode !== 'bird' || gameStatus !== 'playing') return;

                const update = () => {
                    setBirdPos(prev => {
                        const newY = prev.y + prev.velocity;
                        const newVel = prev.velocity + 0.4; // é‡åŠ›
                        
                        // é‚Šç•Œæª¢æŸ¥
                        if (newY > 380 || newY < 0) {
                            setGameStatus('gameOver');
                            playSound('hit');
                        }
                        return { y: newY, velocity: newVel };
                    });

                    setPipes(prev => {
                        let newPipes = prev.map(p => ({ ...p, x: p.x - 3 }));
                        
                        // ç”Ÿæˆæ–°æ°´ç®¡
                        if (newPipes.length > 0 && newPipes[newPipes.length - 1].x < 350) {
                            newPipes.push({ x: 600, gapTop: Math.random() * 200 + 50 });
                        }
                        
                        // ç§»é™¤èˆŠæ°´ç®¡ä¸¦å¾—åˆ†
                        if (newPipes[0].x < -50) {
                            newPipes.shift();
                            setScore(s => s + 1);
                            playSound('score');
                        }

                        // ç¢°æ’æª¢æŸ¥
                        const birdX = 100;
                        const birdY = birdPos.y;
                        newPipes.forEach(p => {
                            if (birdX + 20 > p.x && birdX - 20 < p.x + 50) {
                                if (birdY - 15 < p.gapTop || birdY + 15 > p.gapTop + 120) {
                                    setGameStatus('gameOver');
                                    playSound('hit');
                                }
                            }
                        });

                        return newPipes;
                    });
                    gameLoopRef.current = requestAnimationFrame(update);
                };

                gameLoopRef.current = requestAnimationFrame(update);
                return () => cancelAnimationFrame(gameLoopRef.current);
            }, [mode, gameStatus, birdPos.y]);

            useEffect(() => {
                const onKey = (e) => handleAction(e.key.toUpperCase());
                window.addEventListener('keydown', onKey);
                return () => window.removeEventListener('keydown', onKey);
            }, [mode, targetKey, gameStatus]);

            const rows = [
                ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],
                ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                ['Z', 'X', 'C', 'V', 'B', 'N', 'M']
            ];

            if (mode === 'menu') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gradient-to-br from-blue-400 to-indigo-600">
                        <div className="bg-white p-10 rounded-[40px] shadow-2xl text-center max-w-2xl w-full border-8 border-white/50">
                            <h1 className="text-5xl font-black text-indigo-600 mb-2 flex items-center justify-center gap-3">
                                <SvgIcon name="keyboard" className="w-12 h-12" /> å¿«æ¨‚æ‰“å­—å“¡
                            </h1>
                            <p className="text-gray-400 font-bold mb-10">å°ˆç‚ºå°æœ‹å‹è¨­è¨ˆçš„å•Ÿè’™App</p>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onClick={() => { initAudio(); setMode('free'); }} className="bg-green-400 hover:bg-green-500 text-white p-6 rounded-3xl shadow-[0_6px_0_#16a34a] active:shadow-none active:translate-y-1 transition-all">
                                    <SvgIcon name="sparkles" className="mx-auto mb-2 w-10 h-10" />
                                    <div className="font-black text-xl">è‡ªç”±æ¨¡å¼</div>
                                </button>
                                <button onClick={() => { initAudio(); setMode('challenge'); setTargetKey('A'); speak('A'); }} className="bg-orange-400 hover:bg-orange-500 text-white p-6 rounded-3xl shadow-[0_6px_0_#ea580c] active:shadow-none active:translate-y-1 transition-all">
                                    <SvgIcon name="trophy" className="mx-auto mb-2 w-10 h-10" />
                                    <div className="font-black text-xl">å­—æ¯æŒ‘æˆ°</div>
                                </button>
                                <button onClick={() => { initAudio(); setMode('bird'); setGameStatus('waiting'); }} className="bg-blue-400 hover:bg-blue-500 text-white p-6 rounded-3xl shadow-[0_6px_0_#2563eb] active:shadow-none active:translate-y-1 transition-all">
                                    <SvgIcon name="bird" className="mx-auto mb-2 w-10 h-10" />
                                    <div className="font-black text-xl">æ‰“å­—é£›è¡Œ</div>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-screen flex flex-col bg-sky-50">
                    <div className="bg-white p-4 shadow flex justify-between items-center px-10">
                        <button onClick={() => setMode('menu')} className="bg-gray-100 px-6 py-2 rounded-xl font-bold text-gray-600 flex items-center gap-2">
                            <SvgIcon name="home" /> è¿”å›é¦–é 
                        </button>
                        <div className="font-black text-xl text-blue-600">
                            {mode === 'free' ? 'è‡ªç”±ç·´ç¿’' : mode === 'challenge' ? 'å­—æ¯æŒ‘æˆ°' : 'æ‰“å­—é£›è¡Œå“¡'}
                            { (mode === 'challenge' || mode === 'bird') && <span className="ml-4 bg-yellow-400 text-white px-4 py-1 rounded-full">åˆ†æ•¸: {score}</span>}
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center p-4">
                        {mode === 'bird' ? (
                            <div className="relative w-full max-w-[600px] h-[400px] bg-sky-300 rounded-[30px] overflow-hidden border-8 border-white shadow-2xl">
                                {/* æ°´ç®¡ */}
                                {pipes.map((p, i) => (
                                    <React.Fragment key={i}>
                                        <div className="absolute bg-green-500 border-x-4 border-green-700" style={{ left: p.x, top: 0, width: 50, height: p.gapTop, borderRadius: '0 0 10px 10px' }} />
                                        <div className="absolute bg-green-500 border-x-4 border-green-700" style={{ left: p.x, top: p.gapTop + 120, width: 50, height: 400 - (p.gapTop + 120), borderRadius: '10px 10px 0 0' }} />
                                    </React.Fragment>
                                ))}
                                {/* å°é³¥ */}
                                <div className="absolute transition-transform duration-100" style={{ left: 100, top: birdPos.y, transform: `rotate(${birdPos.velocity * 3}deg)` }}>
                                    <div className="w-10 h-10 bg-yellow-400 rounded-full border-4 border-white flex items-center justify-center shadow-lg">
                                        <span className="text-white font-black text-xl">{displayKey.char || "ğŸ¤"}</span>
                                    </div>
                                    <div className="absolute -left-2 top-2 w-4 h-3 bg-white rounded-full opacity-60" /> {/* ç¿…è†€ */}
                                </div>
                                
                                {gameStatus === 'waiting' && (
                                    <div className="absolute inset-0 bg-black/20 flex flex-col items-center justify-center text-white">
                                        <div className="text-4xl font-black mb-4">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
                                        <div className="text-xl font-bold animate-pulse">æŒ‰ä¸‹éµç›¤ä»»ä½•å­—æ¯é–‹å§‹é£›è¡Œï¼</div>
                                    </div>
                                )}
                                {gameStatus === 'gameOver' && (
                                    <div className="absolute inset-0 bg-red-500/40 flex flex-col items-center justify-center text-white">
                                        <div className="text-5xl font-black mb-2">å“å‘€ï¼</div>
                                        <div className="text-2xl font-bold mb-6">å¾—åˆ†ï¼š{score}</div>
                                        <div className="bg-white text-red-500 px-8 py-3 rounded-full font-black text-xl animate-bounce">æŒ‰ä»»æ„éµé‡æ–°é–‹å§‹</div>
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div className="h-64 flex items-center justify-center">
                                {mode === 'free' ? (
                                    <div className={`text-[180px] font-black ${displayKey.color} ${currentKey ? 'pop-effect' : ''}`}>{displayKey.char || "?"}</div>
                                ) : (
                                    <div className={`flex flex-col items-center gap-4 ${feedback === 'wrong' ? 'shake' : ''}`}>
                                        <div className="w-56 h-56 rounded-[50px] bg-white shadow-xl flex items-center justify-center text-[130px] font-black border-b-[12px] border-gray-200">
                                            {targetKey}
                                        </div>
                                        {feedback === 'correct' && <div className="text-3xl font-black text-green-500">ğŸŒŸ å¤ªæ£’äº†ï¼ ğŸŒŸ</div>}
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="mt-8 bg-gray-800 p-6 rounded-[35px] shadow-2xl border-b-[10px] border-gray-900 w-full max-w-4xl">
                            {rows.map((row, rIdx) => (
                                <div key={rIdx} className="flex justify-center gap-2 mb-3">
                                    {row.map(key => (
                                        <div key={key} className={`
                                            w-14 sm:w-16 h-14 sm:h-16 flex items-center justify-center rounded-2xl text-xl font-black transition-all
                                            ${currentKey === key ? 'key-active' : (mode === 'challenge' && targetKey === key ? 'bg-blue-300 text-blue-800 animate-pulse' : 'bg-gray-100 text-gray-700')}
                                            border-b-4 border-gray-300
                                        `}>
                                            {key}
                                        </div>
                                    ))}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

