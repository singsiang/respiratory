<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¹¼å…’å•Ÿè’™å°éŠæˆ² - Toddler Learning App (Audio)</title>
    <!-- è¼‰å…¥ React èˆ‡ Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        body {
            margin: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: manipulation;
            font-family: system-ui, -apple-system, sans-serif;
        }
        .bubble-float {
            animation: float 4s infinite ease-in-out;
        }
        .full-h {
            height: 100vh;
            height: 100dvh;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- éŸ³æ•ˆèˆ‡èªéŸ³å·¥å…· ---
        const useAudio = () => {
            const audioCtx = useMemo(() => new (window.AudioContext || window.webkitAudioContext)(), []);

            const playTone = (freq, type, duration) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + duration);
            };

            const sounds = {
                pop: () => playTone(600, 'sine', 0.1),
                correct: () => {
                    playTone(523.25, 'sine', 0.1); // C5
                    setTimeout(() => playTone(659.25, 'sine', 0.1), 100); // E5
                    setTimeout(() => playTone(783.99, 'sine', 0.1), 200); // G5
                },
                wrong: () => playTone(150, 'triangle', 0.3),
                click: () => playTone(400, 'sine', 0.05)
            };

            const speak = (text) => {
                window.speechSynthesis.cancel(); // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-TW';
                utterance.rate = 0.9; // ç¨å¾®æ…¢ä¸€é»é»
                window.speechSynthesis.speak(utterance);
            };

            return { sounds, speak };
        };

        // --- å°åœ–ç¤ºçµ„ä»¶ ---
        const Icon = ({ name, className }) => {
            const icons = {
                home: (
                    <>
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </>
                ),
                target: (
                    <>
                        <circle cx="12" cy="12" r="10"/>
                        <circle cx="12" cy="12" r="6"/>
                        <circle cx="12" cy="12" r="2"/>
                    </>
                ),
                grid: (
                    <>
                        <rect width="7" height="7" x="3" y="3" rx="1"/>
                        <rect width="7" height="7" x="14" y="3" rx="1"/>
                        <rect width="7" height="7" x="14" y="14" rx="1"/>
                        <rect width="7" height="7" x="3" y="14" rx="1"/>
                    </>
                ),
                volume: (
                    <>
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                    </>
                ),
                calc: (
                    <>
                        <rect width="16" height="20" x="4" y="2" rx="2"/>
                        <line x1="8" x2="16" y1="6" y2="6"/>
                        <line x1="16" x2="16" y1="14" y2="18"/>
                        <path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/>
                    </>
                )
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        // --- å­éŠæˆ² 1ï¼šæ³¡æ³¡æ´¾å° ---
        const BubbleGame = ({ onBack }) => {
            const [bubbles, setBubbles] = useState([]);
            const [score, setScore] = useState(0);
            const { sounds } = useAudio();

            const addBubble = useCallback(() => {
                const id = Date.now() + Math.random();
                const size = Math.random() * 50 + 70; 
                const x = Math.random() * (window.innerWidth - size);
                const y = Math.random() * (window.innerHeight - size - 120) + 60;
                const colors = ['bg-blue-400', 'bg-pink-400', 'bg-yellow-400', 'bg-green-400', 'bg-purple-400'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                setBubbles(prev => [...prev.slice(-8), { id, x, y, size, color }]);
            }, []);

            useEffect(() => {
                const interval = setInterval(addBubble, 1400);
                return () => clearInterval(interval);
            }, [addBubble]);

            return (
                <div className="relative w-full full-h bg-blue-50 overflow-hidden select-none">
                    <div className="absolute top-4 left-4 z-10 flex gap-4 items-center">
                        <button onClick={onBack} className="p-3 bg-white rounded-full shadow-lg active:scale-90 transition">
                            <Icon name="home" className="w-6 h-6 text-blue-600" />
                        </button>
                        <span className="text-xl font-bold text-blue-800 bg-white/80 px-5 py-2 rounded-full shadow-sm">å¾—åˆ†: {score}</span>
                    </div>
                    {bubbles.map(b => (
                        <div
                            key={b.id}
                            onPointerDown={() => { 
                                sounds.pop();
                                setBubbles(prev => prev.filter(x => x.id !== b.id)); 
                                setScore(s => s + 1); 
                            }}
                            className={`absolute rounded-full shadow-xl bubble-float cursor-pointer transition-all duration-300 opacity-80 border-4 border-white ${b.color}`}
                            style={{ left: b.x, top: b.y, width: b.size, height: b.size }}
                        >
                            <div className="absolute top-3 left-3 w-1/4 h-1/4 bg-white/40 rounded-full" />
                        </div>
                    ))}
                </div>
            );
        };

        // --- å­éŠæˆ² 2ï¼šé¡è‰²æ¨‚åœ’ ---
        const ColorGame = ({ onBack }) => {
            const COLORS = [
                { name: 'ç´…è‰²', value: 'bg-red-500', emoji: 'ğŸ' },
                { name: 'è—è‰²', value: 'bg-blue-500', emoji: 'ğŸ¦‹' },
                { name: 'é»ƒè‰²', value: 'bg-yellow-400', emoji: 'ğŸŒ' },
                { name: 'ç¶ è‰²', value: 'bg-green-500', emoji: 'ğŸŒ²' },
            ];
            const [target, setTarget] = useState(COLORS[0]);
            const [feedback, setFeedback] = useState('');
            const { sounds, speak } = useAudio();

            useEffect(() => {
                speak(`è«‹æ‰¾å‡º${target.name}`);
            }, [target]);

            const checkColor = (color) => {
                if (color.name === target.name) {
                    sounds.correct();
                    setFeedback('å¥½æ£’ï¼ç­”å°äº†ï¼ğŸŒŸ');
                    speak(`å¥½æ£’ï¼é€™æ˜¯${color.name}`);
                    setTimeout(() => {
                        setTarget(COLORS[Math.floor(Math.random() * COLORS.length)]);
                        setFeedback('');
                    }, 2000);
                } else {
                    sounds.wrong();
                    setFeedback('å†è©¦ä¸€æ¬¡çœ‹çœ‹å–”ï¼ğŸ’ª');
                    speak(`å–”å–”ï¼Œå†è©¦è©¦çœ‹å–”`);
                }
            };

            return (
                <div className="flex flex-col items-center justify-between full-h bg-orange-50 p-6 select-none">
                    <button onClick={onBack} className="self-start p-3 bg-white rounded-full shadow-lg">
                        <Icon name="home" className="w-6 h-6 text-orange-600" />
                    </button>
                    <div className="text-center flex-1 flex flex-col justify-center">
                        <h2 className="text-3xl font-bold mb-4">è«‹æ‰¾å‡ºã€Œ{target.name}ã€</h2>
                        <div 
                            onClick={() => speak(target.name)}
                            className={`w-32 h-32 rounded-3xl shadow-inner mx-auto ${target.value} border-8 border-white flex items-center justify-center text-5xl mb-6 cursor-pointer active:scale-95 transition`}
                        >
                            {target.emoji}
                        </div>
                        <div className="grid grid-cols-2 gap-4 w-full max-w-sm mx-auto">
                            {COLORS.map(c => (
                                <button key={c.name} onClick={() => checkColor(c)} className={`h-24 rounded-3xl shadow-xl active:scale-95 transition-transform ${c.value} border-4 border-white`} />
                            ))}
                        </div>
                        <div className="h-12 mt-6 text-2xl font-bold text-orange-600">{feedback}</div>
                    </div>
                </div>
            );
        };

        // --- å­éŠæˆ² 3ï¼šå‹•ç‰©é»é»å ---
        const AnimalGame = ({ onBack }) => {
            const ANIMALS = [
                { name: 'å°è²“', emoji: 'ğŸ±', sound: 'å–µï½å–µï½', color: 'bg-yellow-100', audio: 'è²“å’ª' },
                { name: 'ç‹—ç‹—', emoji: 'ğŸ¶', sound: 'æ±ªï¼æ±ªï¼', color: 'bg-orange-100', audio: 'ç‹—ç‹—' },
                { name: 'å°è±¬', emoji: 'ğŸ·', sound: 'å“¼å“¼ï½', color: 'bg-pink-100', audio: 'å°è±¬' },
                { name: 'ç…å­', emoji: 'ğŸ¦', sound: 'å¼ï½ï½', color: 'bg-red-100', audio: 'ç…å­' },
                { name: 'é’è›™', emoji: 'ğŸ¸', sound: 'å‘±ï¼å‘±ï¼', color: 'bg-green-100', audio: 'é’è›™' },
                { name: 'å¤§è±¡', emoji: 'ğŸ˜', sound: 'å“ï½ï½', color: 'bg-blue-100', audio: 'å¤§è±¡' },
            ];
            const [active, setActive] = useState(null);
            const { sounds, speak } = useAudio();

            const handleClick = (a) => {
                sounds.click();
                setActive(a);
                speak(`${a.audio}ã€‚${a.sound}`);
            };

            return (
                <div className="flex flex-col items-center full-h bg-green-50 p-6 select-none overflow-y-auto">
                    <button onClick={onBack} className="self-start p-3 bg-white rounded-full shadow-lg mb-4">
                        <Icon name="home" className="w-6 h-6 text-green-600" />
                    </button>
                    <h2 className="text-2xl font-bold mb-6 text-green-800">é»ä¸€ä¸‹å‹•ç‰©å–”ï¼</h2>
                    <div className="grid grid-cols-2 gap-4 w-full max-w-md pb-10">
                        {ANIMALS.map(a => (
                            <button key={a.name} onClick={() => handleClick(a)} className={`flex flex-col items-center justify-center p-4 rounded-3xl shadow-md active:scale-105 transition ${a.color} border-4 border-transparent`}>
                                <span className="text-6xl mb-1">{a.emoji}</span>
                                <span className="text-lg font-bold text-gray-700">{a.name}</span>
                            </button>
                        ))}
                    </div>
                    {active && (
                        <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-6 z-50" onClick={() => setActive(null)}>
                            <div className={`p-10 rounded-[2.5rem] shadow-2xl text-center animate-bounce ${active.color} border-8 border-white w-full max-w-xs`}>
                                <div className="text-8xl mb-4">{active.emoji}</div>
                                <div className="text-4xl font-black text-gray-800 mb-2">{active.sound}</div>
                                <div className="text-lg text-gray-500 font-bold">é»ä¸€ä¸‹é—œé–‰</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- å­éŠæˆ² 4ï¼šæ•¸å­—è·³è·³ç³– ---
        const CountingGame = ({ onBack }) => {
            const [count, setCount] = useState(0);
            const target = 5;
            const { sounds, speak } = useAudio();

            const handleCount = () => {
                if (count < target) {
                    const next = count + 1;
                    setCount(next);
                    sounds.click();
                    speak(next.toString());
                    if (next === target) {
                        setTimeout(() => {
                            sounds.correct();
                            speak(`å¥½æ£’ï¼ç¸½å…±æœ‰äº”å€‹è˜‹æœ`);
                        }, 600);
                    }
                } else {
                    setCount(0);
                    sounds.click();
                    speak("é‡æ–°é–‹å§‹");
                }
            };

            return (
                <div className="flex flex-col items-center justify-between full-h bg-purple-50 p-8 select-none">
                    <button onClick={onBack} className="self-start p-3 bg-white rounded-full shadow-lg">
                        <Icon name="home" className="w-6 h-6 text-purple-600" />
                    </button>
                    <div className="text-center flex-1 flex flex-col justify-center">
                        <h2 className="text-3xl font-bold text-purple-800 mb-2">æ•¸ä¸€æ•¸ï¼šå…±æœ‰å¹¾å€‹ï¼Ÿ</h2>
                        <div className="text-7xl font-black text-purple-600 mb-4">{count}</div>
                        <div className="flex flex-wrap justify-center gap-4 mb-10 min-h-[80px]">
                            {Array.from({ length: count }).map((_, i) => (
                                <div key={i} className="text-5xl animate-bounce">ğŸ</div>
                            ))}
                        </div>
                        <button onClick={handleCount} className="px-10 py-5 bg-purple-500 text-white rounded-full text-2xl font-bold shadow-2xl active:scale-90 transition mx-auto">
                            {count < target ? 'å¢åŠ ä¸€å€‹ ğŸ' : 'é‡æ–°é–‹å§‹'}
                        </button>
                    </div>
                </div>
            );
        };

        // --- ä¸»ç¨‹å¼ä»‹é¢ ---
        const App = () => {
            const [view, setView] = useState('menu');
            const { sounds, speak } = useAudio();

            const handleNavigate = (v, title) => {
                sounds.click();
                setView(v);
                speak(`ç©${title}`);
            };

            const MenuButton = ({ icon, title, sub, color, onClick }) => (
                <button onClick={onClick} className={`flex flex-col items-center justify-center py-5 px-4 rounded-[2rem] shadow-lg transition active:scale-95 ${color} text-white w-full`}>
                    <Icon name={icon} className="w-10 h-10 mb-2" />
                    <span className="text-xl font-bold">{title}</span>
                    <span className="text-xs opacity-90 mt-0.5">{sub}</span>
                </button>
            );

            if (view === 'bubble') return <BubbleGame onBack={() => setView('menu')} />;
            if (view === 'color') return <ColorGame onBack={() => setView('menu')} />;
            if (view === 'animal') return <AnimalGame onBack={() => setView('menu')} />;
            if (view === 'counting') return <CountingGame onBack={() => setView('menu')} />;

            return (
                <div className="full-h flex flex-col items-center p-6 bg-slate-50 overflow-y-auto">
                    <div className="text-center mt-4 mb-8">
                        <h1 className="text-3xl font-black text-slate-800 mb-1">å•Ÿè’™æ¢ç´¢å°éŠæˆ²</h1>
                        <p className="text-lg text-slate-500 font-bold">è²éŸ³äº’å‹•ç‰ˆ</p>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-sm">
                        <MenuButton icon="target" title="æ³¡æ³¡æ´¾å°" sub="æ‰‹çœ¼å”èª¿" color="bg-blue-500" onClick={() => handleNavigate('bubble', 'æ³¡æ³¡æ´¾å°')} />
                        <MenuButton icon="grid" title="è‰²å½©æ¨‚åœ’" sub="èªè­˜é¡è‰²" color="bg-orange-500" onClick={() => handleNavigate('color', 'è‰²å½©æ¨‚åœ’')} />
                        <MenuButton icon="volume" title="å‹•ç‰©é»é»å" sub="å‹•ç‰©èªçŸ¥" color="bg-green-500" onClick={() => handleNavigate('animal', 'å‹•ç‰©é»é»å')} />
                        <MenuButton icon="calc" title="æ•¸å­—è·³è·³ç³–" sub="åŸºç¤æ•¸æ„Ÿ" color="bg-purple-500" onClick={() => handleNavigate('counting', 'æ•¸å­—è·³è·³ç³–')} />
                    </div>
                    <div className="mt-auto py-6 text-slate-400 font-medium text-center text-sm">
                        ğŸ’¡ è²¼å¿ƒæé†’ï¼šéŠæˆ²æœƒèªªè©±å–”ï¼è«‹é–‹å•ŸéŸ³é‡ã€‚
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

