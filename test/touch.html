import React, { useState, useEffect, useCallback } from 'react';
import { Home, Volume2, Star, Target, LayoutGrid, Calculator } from 'lucide-react';

// --- å­éŠæˆ² 1ï¼šæ³¡æ³¡æ´¾å° (æ‰‹çœ¼å”èª¿) ---
const BubbleGame = ({ onBack }) => {
  const [bubbles, setBubbles] = useState([]);
  const [score, setScore] = useState(0);

  const addBubble = useCallback(() => {
    const id = Date.now() + Math.random();
    const size = Math.random() * 40 + 60; // è¼ƒå¤§çš„é»æ“Šç›®æ¨™
    const x = Math.random() * (window.innerWidth - size);
    const y = Math.random() * (window.innerHeight - size - 100);
    const colors = ['bg-blue-400', 'bg-pink-400', 'bg-yellow-400', 'bg-green-400', 'bg-purple-400'];
    const color = colors[Math.floor(Math.random() * colors.length)];
    
    setBubbles(prev => [...prev, { id, x, y, size, color }]);
  }, []);

  useEffect(() => {
    const interval = setInterval(addBubble, 1200);
    return () => clearInterval(interval);
  }, [addBubble]);

  const popBubble = (id) => {
    setBubbles(prev => prev.filter(b => b.id !== id));
    setScore(s => s + 1);
  };

  return (
    <div className="relative w-full h-screen bg-blue-50 overflow-hidden select-none">
      <div className="absolute top-4 left-4 z-10 flex gap-4 items-center">
        <button onClick={onBack} className="p-4 bg-white rounded-full shadow-lg hover:scale-110 transition">
          <Home className="w-8 h-8 text-blue-600" />
        </button>
        <span className="text-2xl font-bold text-blue-800 bg-white/80 px-4 py-2 rounded-full">é»é»æ³¡æ³¡: {score}</span>
      </div>
      
      {bubbles.map(b => (
        <button
          key={b.id}
          onClick={() => popBubble(b.id)}
          className={`absolute rounded-full shadow-xl transform active:scale-150 transition-all duration-300 opacity-70 border-4 border-white ${b.color}`}
          style={{
            left: b.x,
            top: b.y,
            width: b.size,
            height: b.size,
            animation: 'float 4s infinite ease-in-out'
          }}
        >
          <div className="absolute top-2 left-2 w-1/3 h-1/3 bg-white/30 rounded-full" />
        </button>
      ))}

      <style>{`
        @keyframes float {
          0%, 100% { transform: translateY(0px) rotate(0deg); }
          50% { transform: translateY(-20px) rotate(5deg); }
        }
      `}</style>
    </div>
  );
};

// --- å­éŠæˆ² 2ï¼šé¡è‰²æ¨‚åœ’ (é¡è‰²åˆ†è¾¨) ---
const ColorGame = ({ onBack }) => {
  const COLORS = [
    { name: 'ç´…è‰²', value: 'bg-red-500', emoji: 'ğŸ' },
    { name: 'è—è‰²', value: 'bg-blue-500', emoji: 'ğŸ¦‹' },
    { name: 'é»ƒè‰²', value: 'bg-yellow-400', emoji: 'ğŸŒ' },
    { name: 'ç¶ è‰²', value: 'bg-green-500', emoji: 'ğŸŒ²' },
  ];

  const [target, setTarget] = useState(COLORS[0]);
  const [feedback, setFeedback] = useState('');

  const checkColor = (color) => {
    if (color.name === target.name) {
      setFeedback('å¥½æ£’ï¼ç­”å°äº†ï¼ğŸŒŸ');
      setTimeout(() => {
        setTarget(COLORS[Math.floor(Math.random() * COLORS.length)]);
        setFeedback('');
      }, 1500);
    } else {
      setFeedback('å†è©¦ä¸€æ¬¡çœ‹çœ‹å–”ï¼ğŸ’ª');
    }
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-orange-50 p-8 select-none">
      <button onClick={onBack} className="absolute top-4 left-4 p-4 bg-white rounded-full shadow-lg">
        <Home className="w-8 h-8 text-orange-600" />
      </button>

      <div className="mb-8 text-center">
        <h2 className="text-4xl font-bold mb-4">è«‹æ‰¾å‡ºã€Œ{target.name}ã€</h2>
        <div className={`w-32 h-32 rounded-3xl shadow-inner mx-auto ${target.value} border-8 border-white flex items-center justify-center text-5xl`}>
          {target.emoji}
        </div>
      </div>

      <div className="grid grid-cols-2 gap-6 w-full max-w-md">
        {COLORS.map(c => (
          <button
            key={c.name}
            onClick={() => checkColor(c)}
            className={`h-32 rounded-3xl shadow-xl transform active:scale-95 transition-transform ${c.value} border-4 border-white`}
          />
        ))}
      </div>

      {feedback && (
        <div className="mt-8 text-3xl font-bold text-orange-600 animate-bounce">
          {feedback}
        </div>
      )}
    </div>
  );
};

// --- å­éŠæˆ² 3ï¼šå‹•ç‰©é»é»å (å› æœé—œä¿‚èˆ‡èªçŸ¥) ---
const AnimalGame = ({ onBack }) => {
  const ANIMALS = [
    { name: 'å°è²“', emoji: 'ğŸ±', sound: 'å–µï½å–µï½', color: 'bg-yellow-100' },
    { name: 'ç‹—ç‹—', emoji: 'ğŸ¶', sound: 'æ±ªï¼æ±ªï¼', color: 'bg-orange-100' },
    { name: 'å°è±¬', emoji: 'ğŸ·', sound: 'å“¼å“¼ï½', color: 'bg-pink-100' },
    { name: 'ç…å­', emoji: 'ğŸ¦', sound: 'å¼ï½ï½', color: 'bg-red-100' },
    { name: 'é’è›™', emoji: 'ğŸ¸', sound: 'å‘±ï¼å‘±ï¼', color: 'bg-green-100' },
    { name: 'å¤§è±¡', emoji: 'ğŸ˜', sound: 'å“ï½ï½', color: 'bg-blue-100' },
  ];

  const [active, setActive] = useState(null);

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-green-50 p-6 select-none">
      <button onClick={onBack} className="absolute top-4 left-4 p-4 bg-white rounded-full shadow-lg">
        <Home className="w-8 h-8 text-green-600" />
      </button>

      <h2 className="text-3xl font-bold mb-8 text-green-800">å‹•ç‰©é»é»åï¼šé»ä¸€ä¸‹å‹•ç‰©å–”ï¼</h2>

      <div className="grid grid-cols-2 sm:grid-cols-3 gap-6 w-full max-w-2xl">
        {ANIMALS.map(a => (
          <button
            key={a.name}
            onClick={() => setActive(a)}
            className={`flex flex-col items-center justify-center p-6 rounded-3xl shadow-md transform transition active:scale-110 ${a.color} hover:shadow-xl`}
          >
            <span className="text-7xl mb-2">{a.emoji}</span>
            <span className="text-xl font-bold text-gray-700">{a.name}</span>
          </button>
        ))}
      </div>

      {active && (
        <div className="fixed inset-0 bg-black/40 flex items-center justify-center p-8 z-50" onClick={() => setActive(null)}>
          <div className={`p-12 rounded-[3rem] shadow-2xl text-center scale-125 animate-in zoom-in-50 duration-300 ${active.color} border-8 border-white`}>
            <div className="text-9xl mb-6">{active.emoji}</div>
            <div className="text-5xl font-black text-gray-800 mb-4">{active.sound}</div>
            <div className="text-2xl text-gray-500 font-bold">é»ä¸€ä¸‹ç•«é¢é—œé–‰</div>
          </div>
        </div>
      )}
    </div>
  );
};

// --- å­éŠæˆ² 4ï¼šæ•¸å­—è·³è·³ç³– (åŸºç¤æ•¸æ„Ÿ) ---
const CountingGame = ({ onBack }) => {
  const [count, setCount] = useState(0);
  const target = 5;

  const handleAppleClick = () => {
    if (count < target) {
      setCount(prev => prev + 1);
    } else {
      setCount(0);
    }
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-purple-50 p-8 select-none">
      <button onClick={onBack} className="absolute top-4 left-4 p-4 bg-white rounded-full shadow-lg">
        <Home className="w-8 h-8 text-purple-600" />
      </button>

      <div className="text-center mb-12">
        <h2 className="text-4xl font-bold text-purple-800 mb-4">æ•¸ä¸€æ•¸ï¼šå…±æœ‰å¹¾å€‹ï¼Ÿ</h2>
        <div className="text-8xl font-black text-purple-600">{count}</div>
      </div>

      <div className="flex flex-wrap justify-center gap-6 mb-12 min-h-[160px]">
        {Array.from({ length: count }).map((_, i) => (
          <div key={i} className="text-7xl animate-bounce" style={{ animationDelay: `${i * 0.1}s` }}>
            ğŸ
          </div>
        ))}
      </div>

      <button
        onClick={handleAppleClick}
        className="px-12 py-6 bg-purple-500 text-white rounded-full text-3xl font-bold shadow-2xl hover:bg-purple-600 active:scale-90 transition transform"
      >
        {count < target ? 'å¢åŠ ä¸€å€‹ ğŸ' : 'é‡æ–°é–‹å§‹'}
      </button>
    </div>
  );
};

// --- ä¸»ä»‹é¢ ---
const App = () => {
  const [view, setView] = useState('menu');

  const MenuButton = ({ icon: Icon, title, sub, color, onClick }) => (
    <button
      onClick={onClick}
      className={`flex flex-col items-center justify-center p-8 rounded-[2.5rem] shadow-xl transition transform hover:scale-105 active:scale-95 ${color} text-white w-full max-w-xs`}
    >
      <Icon className="w-16 h-16 mb-4" />
      <span className="text-2xl font-bold">{title}</span>
      <span className="text-sm opacity-90">{sub}</span>
    </button>
  );

  switch (view) {
    case 'bubble': return <BubbleGame onBack={() => setView('menu')} />;
    case 'color': return <ColorGame onBack={() => setView('menu')} />;
    case 'animal': return <AnimalGame onBack={() => setView('menu')} />;
    case 'counting': return <CountingGame onBack={() => setView('menu')} />;
    default:
      return (
        <div className="min-h-screen bg-gray-50 flex flex-col items-center py-12 px-6">
          <div className="text-center mb-12">
            <h1 className="text-5xl font-black text-gray-800 mb-2">å•Ÿè’™æ¢ç´¢å°éŠæˆ²</h1>
            <p className="text-xl text-gray-500 font-medium">é©åˆ 3 æ­²å¹¼å…’çš„å¿«æ¨‚å­¸ç¿’æ™‚å…‰</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-2xl">
            <MenuButton
              icon={Target}
              title="æ³¡æ³¡æ´¾å°"
              sub="è¨“ç·´æ‰‹çœ¼å”èª¿"
              color="bg-blue-500"
              onClick={() => setView('bubble')}
            />
            <MenuButton
              icon={LayoutGrid}
              title="è‰²å½©æ¨‚åœ’"
              sub="èªè­˜æ¼‚äº®é¡è‰²"
              color="bg-orange-500"
              onClick={() => setView('color')}
            />
            <MenuButton
              icon={Volume2}
              title="å‹•ç‰©é»é»å"
              sub="å­¸ç¿’å‹•ç‰©è©å½™"
              color="bg-green-500"
              onClick={() => setView('animal')}
            />
            <MenuButton
              icon={Calculator}
              title="æ•¸å­—è·³è·³ç³–"
              sub="ç·´ç¿’ 123 æ•¸æ•¸"
              color="bg-purple-500"
              onClick={() => setView('counting')}
            />
          </div>

          <div className="mt-16 text-center text-gray-400 text-sm">
            ğŸ’¡ çµ¦å®¶é•·çš„å»ºè­°ï¼šè«‹é™ªä¼´å­©å­ä¸€èµ·é»é»çœ‹ï¼Œä¸¦é‡è¤‡å‹•ç‰©æˆ–é¡è‰²çš„åç¨±å–”ï¼
          </div>
        </div>
      );
  }
};

export default App;
