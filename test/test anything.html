<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å‘¼å¸å™¨ç©ºæ©Ÿé»ç­ç³»çµ±</title>
  <!-- å¼•å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- å¼•å…¥ React èˆ‡ ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- å¼•å…¥ Babel è®“ç€è¦½å™¨å¯ä»¥ç›´æ¥ç·¨è­¯ JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- å¼•å…¥ html2canvas ç”¨æ–¼åŒ¯å‡ºåœ–ç‰‡ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒå¯ä»¥æ»¾å‹• */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    /* é˜²æ­¢æ‰‹æ©Ÿé»æ“Šé–ƒçˆ */
    body { -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans pb-20">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // --- åœ–ç¤ºå…ƒä»¶ (å–ä»£å¤–éƒ¨ä¾è³´ï¼Œç¢ºä¿å–®æª”å®Œç¾é‹è¡Œ) ---
    const IconClipboard = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>
    );
    const IconCamera = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
    );
    const IconCheck = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>
    );
    const IconAlert = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
    );
    const IconX = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
    );

    // --- è³‡æ–™æ¨¡å‹å®šç¾© ---
    const AREAS = ['9F', 'MICU', 'ER', 'VMICU'];
    const ITEMS = [
      { id: 'po_por', name: 'PO(por)', validAreas: ['VMICU'], isYellow: true },
      { id: 'po_nt1d', name: 'PO(NT1D)', validAreas: ['9F', 'VMICU'], isYellow: true },
      { id: 'savina', name: 'Savina', validAreas: ['9F', 'MICU', 'ER', 'VMICU'] },
      { id: 'savina300', name: 'Savina300', validAreas: ['9F', 'MICU'] },
      { id: 'v600', name: 'V600', validAreas: ['9F', 'MICU'] },
      { id: 'servo300', name: 'Servo300', validAreas: ['9F'] },
      { id: 'galileo', name: 'Galileo', validAreas: ['9F'] },
      { id: 'dura', name: 'Dura', validAreas: ['MICU'] },
      { id: 'evita4', name: 'Evita-4', validAreas: ['MICU', 'VMICU'] },
      { id: 'po', name: 'PO', validAreas: ['9F'] },
      { id: 'nonin', name: 'Nonin', validAreas: ['9F'] },
      { id: 'hfnc', name: 'HFNC(AirVO2)', validAreas: ['9F', 'MICU', 'ER', 'VMICU'] },
      { id: 'flexo', name: 'Flexo', validAreas: ['9F', 'MICU', 'ER', 'VMICU'] },
      { id: 'trilogy', name: 'Trilogy', validAreas: ['VMICU'] },
      { id: 'stellar', name: 'Stellar', validAreas: ['9F', 'MICU', 'ER'] }
    ];

    function App() {
      const [activeTab, setActiveTab] = useState('9F');
      const [inventory, setInventory] = useState({});
      const [isExporting, setIsExporting] = useState(false);
      const [modal, setModal] = useState({ isOpen: false, type: 'alert', message: '', onConfirm: null });
      const tableRef = useRef(null);

      // åˆå§‹åŒ–è³‡æ–™ (å˜—è©¦è®€å–æš«å­˜)
      useEffect(() => {
        const initialData = {};
        AREAS.forEach(area => {
          initialData[area] = {};
          ITEMS.forEach(item => {
            initialData[area][item.id] = item.validAreas.includes(area) ? '0' : 'N/A';
          });
        });
        
        try {
          const savedData = localStorage.getItem('hospital_inventory_data');
          if (savedData) {
            setInventory(JSON.parse(savedData));
          } else {
            setInventory(initialData);
          }
        } catch (e) {
          setInventory(initialData);
        }
      }, []);

      // è³‡æ–™è®Šæ›´æ™‚è‡ªå‹•å„²å­˜
      useEffect(() => {
        if (Object.keys(inventory).length > 0) {
          localStorage.setItem('hospital_inventory_data', JSON.stringify(inventory));
        }
      }, [inventory]);

      const showAlert = (message) => setModal({ isOpen: true, type: 'alert', message, onConfirm: null });
      const showConfirm = (message, onConfirm) => setModal({ isOpen: true, type: 'confirm', message, onConfirm });
      const closeModal = () => setModal({ isOpen: false, type: 'alert', message: '', onConfirm: null });

      const handleInputChange = (area, itemId, value) => {
        setInventory(prev => ({
          ...prev, [area]: { ...prev[area], [itemId]: value }
        }));
      };

      const appendStatus = (area, itemId, statusStr) => {
        setInventory(prev => {
          let currentVal = prev[area][itemId];
          if (currentVal === '0' || currentVal === '') currentVal = `0${statusStr}`;
          else currentVal = `${currentVal}${statusStr}`;
          return { ...prev, [area]: { ...prev[area], [itemId]: currentVal } };
        });
      };

      const requestClearData = () => {
        showConfirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰é»ç­ç´€éŒ„å—ï¼Ÿè³‡æ–™å°‡æœƒæ­¸é›¶ã€‚', () => {
          const resetData = { ...inventory };
          AREAS.forEach(area => {
            ITEMS.forEach(item => {
              if (item.validAreas.includes(area)) resetData[area][item.id] = '0';
            });
          });
          setInventory(resetData);
          showAlert('è³‡æ–™å·²æˆåŠŸæ¸…ç©ºï¼');
        });
      };

      const exportAsImage = async () => {
        if (!window.html2canvas) {
          showAlert('ç³»çµ±å°šæœªæº–å‚™å¥½ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
          return;
        }
        
        setIsExporting(true);
        try {
          const canvas = await window.html2canvas(tableRef.current, {
            scale: 2, backgroundColor: '#ffffff', useCORS: true
          });
          
          const image = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.href = image;
          const d = new Date();
          const dateString = `${d.getMonth()+1}æœˆ${d.getDate()}æ—¥_${d.getHours()}æ™‚${d.getMinutes()}åˆ†`;
          link.download = `ç©ºæ©Ÿé»ç­çµ±è¨ˆ_${dateString}.png`;
          link.click();
        } catch (err) {
          console.error('åŒ¯å‡ºå¤±æ•—:', err);
          showAlert('åŒ¯å‡ºåœ–ç‰‡å¤±æ•—ï¼Œè«‹ç¢ºèªç€è¦½å™¨æ”¯æ´æ­¤åŠŸèƒ½ã€‚');
        } finally {
          setIsExporting(false);
        }
      };

      if (Object.keys(inventory).length === 0) {
        return <div className="p-10 text-center text-slate-500">è¼‰å…¥ä¸­...</div>;
      }

      return (
        <div className="min-h-screen flex flex-col">
          {/* è‡ªè¨‚ Modal */}
          {modal.isOpen && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
              <div className="bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200">
                <div className="p-6">
                  <h3 className="text-lg font-bold text-slate-800 mb-2">ç³»çµ±æç¤º</h3>
                  <p className="text-slate-600">{modal.message}</p>
                </div>
                <div className="bg-slate-50 p-4 flex justify-end gap-3 border-t border-slate-100">
                  {modal.type === 'confirm' && (
                    <button onClick={closeModal} className="px-4 py-2 text-slate-600 bg-white border border-slate-300 rounded-lg hover:bg-slate-50">
                      å–æ¶ˆ
                    </button>
                  )}
                  <button 
                    onClick={() => {
                      if (modal.onConfirm) modal.onConfirm();
                      closeModal();
                    }} 
                    className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md"
                  >
                    ç¢ºå®š
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* é ‚éƒ¨å°è¦½åˆ— */}
          <header className="bg-blue-700 text-white shadow-md sticky top-0 z-20">
            <div className="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
              <div className="flex items-center gap-2">
                <IconClipboard />
                <h1 className="text-lg md:text-xl font-bold tracking-wider">å‘¼å¸å™¨ç©ºæ©Ÿé»ç­</h1>
              </div>
              <button onClick={requestClearData} className="text-blue-200 hover:text-white flex items-center gap-1 text-sm bg-blue-800 px-3 py-1.5 rounded-lg transition active:scale-95">
                <IconX />æ¸…ç©º
              </button>
            </div>
            
            {/* æ¨™ç±¤é åˆ‡æ› */}
            <div className="flex overflow-x-auto hide-scrollbar border-t border-blue-600">
              {AREAS.map(area => (
                <button
                  key={area}
                  onClick={() => setActiveTab(area)}
                  className={`flex-1 py-3 px-4 min-w-[80px] text-center font-medium border-b-4 transition-colors ${
                    activeTab === area ? 'border-white bg-blue-800 text-white' : 'border-transparent text-blue-200 hover:bg-blue-600'
                  }`}
                >
                  {area}
                </button>
              ))}
              <button
                onClick={() => setActiveTab('SUMMARY')}
                className={`flex-1 py-3 px-4 min-w-[100px] text-center font-bold border-b-4 transition-colors ${
                  activeTab === 'SUMMARY' ? 'border-yellow-400 bg-blue-800 text-yellow-400' : 'border-transparent text-blue-200 hover:bg-blue-600'
                }`}
              >
                ç¸½è¡¨é è¦½
              </button>
            </div>
          </header>

          <main className="flex-1 max-w-4xl w-full mx-auto p-4 md:p-6">
            {/* å€åŸŸé»ç­å€å¡Š */}
            {AREAS.includes(activeTab) && (
              <div className="space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex justify-between items-center mb-2">
                  <div>
                    <h2 className="text-lg font-bold text-slate-700">å€åŸŸï¼š{activeTab}</h2>
                    <p className="text-sm text-slate-500">å·²éš±è—ä¸éœ€é»ç­ä¹‹å„€å™¨</p>
                  </div>
                  <div className="text-green-500 opacity-20"><IconCheck /></div>
                </div>

                <div className="grid gap-3 sm:grid-cols-2">
                  {ITEMS.filter(item => item.validAreas.includes(activeTab)).map(item => (
                    <div key={item.id} className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex flex-col gap-3">
                      <label className="font-bold text-lg text-slate-800 flex justify-between items-center">
                        {item.name}
                        {inventory[activeTab][item.id] === '0' && <span className="text-xs font-normal text-slate-400 bg-slate-100 px-2 py-1 rounded-md">æœªç•°å‹•</span>}
                      </label>
                      
                      <input
                        type="text"
                        value={inventory[activeTab][item.id]}
                        onChange={(e) => handleInputChange(activeTab, item.id, e.target.value)}
                        className="w-full text-xl font-bold p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-shadow"
                      />
                      
                      <div className="flex flex-wrap gap-2 mt-1">
                        <button onClick={() => appendStatus(activeTab, item.id, '+1')} className="px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-md text-sm font-medium transition active:scale-95">
                          +1
                        </button>
                        <button onClick={() => appendStatus(activeTab, item.id, '+1(è«‹ä¿®)')} className="px-3 py-1.5 bg-red-50 hover:bg-red-100 text-red-700 rounded-md text-sm font-medium transition flex items-center gap-1 active:scale-95">
                          <IconAlert /> +1(è«‹ä¿®)
                        </button>
                        <button onClick={() => appendStatus(activeTab, item.id, '+1(è½‰é€)')} className="px-3 py-1.5 bg-orange-50 hover:bg-orange-100 text-orange-700 rounded-md text-sm font-medium transition active:scale-95">
                          +1(è½‰é€)
                        </button>
                        <button onClick={() => handleInputChange(activeTab, item.id, '0')} className="px-3 py-1.5 ml-auto text-slate-500 hover:text-slate-800 text-sm font-medium active:scale-95">
                          æ­¸é›¶
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* ç¸½è¡¨é è¦½å€å¡Š */}
            {activeTab === 'SUMMARY' && (
              <div className="space-y-4 animate-in fade-in zoom-in-95 duration-300">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                  <div>
                    <h2 className="text-lg font-bold text-slate-800">çµ±è¨ˆç¸½è¡¨</h2>
                    <p className="text-sm text-slate-500">è«‹ç¢ºèªè¡¨æ ¼æ•¸æ“šæ˜¯å¦æ­£ç¢º</p>
                  </div>
                  <button 
                    onClick={exportAsImage}
                    disabled={isExporting}
                    className="w-full sm:w-auto flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-lg font-bold shadow-lg shadow-emerald-600/20 transition-all disabled:opacity-70 active:scale-95"
                  >
                    {isExporting ? 'ç”Ÿæˆåœ–ç‰‡ä¸­...' : <><IconCamera /> å„²å­˜ç‚ºåœ–ç‰‡åˆ†äº«</>}
                  </button>
                </div>

                <div className="overflow-x-auto bg-white p-1 md:p-2 rounded-xl shadow-sm border border-slate-200">
                  {/* æ­¤å€å¡Šç‚ºå°‡è¢«è½‰ç‚ºåœ–ç‰‡çš„å…§å®¹ */}
                  <div ref={tableRef} className="p-4 bg-white min-w-[650px]">
                    <table className="w-full border-collapse border-2 border-slate-800 text-center text-[15px]">
                      <thead>
                        <tr>
                          <th className="border border-slate-800 p-2 bg-slate-100 font-bold text-slate-800 w-1/5">ç©ºæ©Ÿçµ±è¨ˆ</th>
                          {AREAS.map(area => (
                            <th key={area} className="border border-slate-800 p-2 bg-slate-100 font-bold text-slate-800 w-1/5">{area}</th>
                          ))}
                        </tr>
                      </thead>
                      <tbody>
                        {ITEMS.map(item => (
                          <tr key={item.id}>
                            <td className={`border border-slate-800 p-2 font-bold text-left ${item.isYellow ? 'bg-amber-400' : 'bg-white'}`}>
                              {item.name}
                            </td>
                            {AREAS.map(area => {
                              const val = inventory[area]?.[item.id];
                              const isNA = val === 'N/A';
                              return (
                                <td 
                                  key={`${area}-${item.id}`} 
                                  className={`border border-slate-800 p-2 ${isNA ? 'bg-gray-300 text-slate-500 text-sm' : 'bg-white text-slate-900 font-bold text-lg'}`}
                                >
                                  {val}
                                </td>
                              );
                            })}
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <div className="bg-blue-50 text-blue-800 p-4 rounded-xl text-sm leading-relaxed border border-blue-100">
                  ğŸ’¡ <strong>å°æé†’ï¼š</strong> è‹¥è¦åˆ†äº«è‡³ LINE ç¾¤çµ„ï¼Œè«‹é»æ“Šä¸Šæ–¹ç¶ è‰²æŒ‰éˆ•å°‡è¡¨æ ¼å„²å­˜ç‚ºåœ–ç‰‡å¾Œç›´æ¥å‚³é€å³å¯ã€‚
                </div>
              </div>
            )}
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>

