<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ROX Index 計算器</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- React 及 ReactDOM CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC",
        "Noto Sans TC", sans-serif;
      background: #f5f7fb;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 520px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      padding: 20px 24px 24px;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 8px 0;
      text-align: center;
    }
    .subtitle {
      font-size: 13px;
      color: #666;
      text-align: center;
      margin-bottom: 16px;
    }
    .field-group {
      margin-bottom: 14px;
    }
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 4px;
    }
    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    input[type="number"]:focus {
      outline: none;
      border-color: #2196f3;
    }
    .hint {
      font-size: 11px;
      color: #777;
      margin-top: 3px;
    }
    .error {
      font-size: 11px;
      color: #c62828;
      margin-top: 3px;
      font-weight: 500;
    }
    .result-card {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      background: #f0f4ff;
    }
    .rox-value {
      font-size: 32px;
      font-weight: 600;
      color: #1565c0;
    }
    .rox-label {
      font-size: 13px;
      color: #555;
      margin-bottom: 4px;
    }
    .status {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      line-height: 1.5;
    }
    .status-low {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #a5d6a7;
    }
    .status-mid {
      background: #fff8e1;
      color: #f57f17;
      border: 1px solid #ffe082;
    }
    .status-high {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ef9a9a;
    }
    .sf-info {
      margin-top: 10px;
      font-size: 12px;
      color: #555;
      padding: 8px;
      background: #fff;
      border-radius: 4px;
    }
    .ref {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #e0e0e0;
      font-size: 11px;
      color: #888;
      line-height: 1.6;
    }
    .example {
      margin-top: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-left: 3px solid #2196f3;
      font-size: 12px;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, useEffect } = React;

    // 風險分級（依文獻：ROX ≥4.88 成功機率高，<3.85、<2.85 風險增加）[web:37][web:4][web:45]
    function classifyROX(rox) {
      if (isNaN(rox) || !isFinite(rox)) {
        return {
          level: "N/A",
          text: "請輸入完整數值以計算 ROX Index。",
          className: ""
        };
      }

      if (rox >= 4.88) {
        return {
          level: "✓ 低風險",
          text: "ROX ≥ 4.88：治療成功機率較高，插管風險相對較低。",
          className: "status status-low"
        };
      } else if (rox >= 3.85) {
        return {
          level: "⚠ 中等風險",
          text: "ROX 3.85–4.88：需密切觀察，視病程與時間點決定是否升級治療。",
          className: "status status-mid"
        };
      } else if (rox >= 2.85) {
        return {
          level: "⚠ 高風險",
          text: "ROX 2.85–3.85：插管風險較高，建議儘早與團隊討論介入。",
          className: "status status-high"
        };
      } else {
        return {
          level: "✕ 極高風險",
          text: "ROX < 2.85：高度懷疑治療失敗，請立即評估升級呼吸支持。",
          className: "status status-high"
        };
      }
    }

    function App() {
      const [spo2, setSpo2] = useState("");
      const [fio2Percent, setFio2Percent] = useState("");
      const [rr, setRr] = useState("");
      const [errors, setErrors] = useState({});

      const spo2Num = parseFloat(spo2);
      const fio2PercentNum = parseFloat(fio2Percent);
      const rrNum = parseFloat(rr);

      // FiO2 以「%輸入」，自動轉為「小數」參與公式：例如 30 → 0.3
      const fio2Decimal =
        !isNaN(fio2PercentNum) && fio2PercentNum > 0
          ? fio2PercentNum / 100
          : NaN;

      let sfRatio = null;
      let rox = null;

      // 驗證
      const newErrors = {};
      if (spo2 !== "" && (spo2Num <= 0 || spo2Num > 100)) {
        newErrors.spo2 = "SpO₂ 應介於 1–100。";
      }
      if (fio2Percent !== "" && (fio2PercentNum < 21 || fio2PercentNum > 100)) {
        newErrors.fio2 = "FiO₂ 通常介於 21–100%。";
      }
      if (rr !== "" && (rrNum <= 0 || rrNum > 80)) {
        newErrors.rr = "RR 應為 1–80 次/分。";
      }
      useEffect(() => setErrors(newErrors), [spo2, fio2Percent, rr]);

      // 計算 SpO2 / FiO2（FiO2 必須是小數）[web:37][web:5]
      if (!isNaN(spo2Num) && !isNaN(fio2Decimal) && fio2Decimal > 0) {
        sfRatio = spo2Num / fio2Decimal;
      }

      // 計算 ROX = (SpO2 / FiO2) / RR [web:37][web:42]
      if (sfRatio !== null && !isNaN(rrNum) && rrNum > 0) {
        rox = sfRatio / rrNum;
      }

      const risk = classifyROX(rox);

      return (
        React.createElement("div", { className: "container" },
          React.createElement("h1", null, "ROX Index 計算器"),
          React.createElement("div", { className: "subtitle" },
            "公式：ROX = (SpO₂ / FiO₂) / RR　（FiO₂ 以小數形式參與計算）"
          ),

          React.createElement("div", { className: "field-group" },
            React.createElement("label", null, "SpO₂ (%)"),
            React.createElement("input", {
              type: "number",
              step: "0.1",
              value: spo2,
              onChange: e => setSpo2(e.target.value),
              placeholder: "例如 94"
            }),
            React.createElement("div", { className: "hint" },
              "脈搏血氧飽和度，輸入整數或小數（如 94 或 94.5）。"
            ),
            errors.spo2 && React.createElement("div", { className: "error" }, errors.spo2)
          ),

          React.createElement("div", { className: "field-group" },
            React.createElement("label", null, "FiO₂ (%)"),
            React.createElement("input", {
              type: "number",
              step: "1",
              value: fio2Percent,
              onChange: e => setFio2Percent(e.target.value),
              placeholder: "例如 30（代表 FiO₂ = 0.30）"
            }),
            React.createElement("div", { className: "hint" },
              "直接輸入百分比數值：輸入 30 代表 FiO₂ = 0.30，輸入 60 代表 FiO₂ = 0.60。"
            ),
            errors.fio2 && React.createElement("div", { className: "error" }, errors.fio2)
          ),

          React.createElement("div", { className: "field-group" },
            React.createElement("label", null, "RR（呼吸次數 / 分）"),
            React.createElement("input", {
              type: "number",
              step: "1",
              value: rr,
              onChange: e => setRr(e.target.value),
              placeholder: "例如 25"
            }),
            React.createElement("div", { className: "hint" }, "每分鐘呼吸次數。"),
            errors.rr && React.createElement("div", { className: "error" }, errors.rr)
          ),

          React.createElement("div", { className: "result-card" },
            React.createElement("div", { className: "rox-label" }, "ROX Index："),
            React.createElement("div", { className: "rox-value" },
              rox !== null && isFinite(rox) ? rox.toFixed(2) : "—"
            ),
            sfRatio !== null && isFinite(sfRatio) && React.createElement("div", { className: "sf-info" },
              "SpO₂/FiO₂ 比值：", sfRatio.toFixed(1),
              (!isNaN(fio2Decimal) && fio2Decimal > 0)
                ? "（FiO₂ = " + fio2Decimal.toFixed(2) + "）"
                : ""
            ),
            React.createElement("div", { className: risk.className }, risk.level + "｜" + risk.text)
          ),

          React.createElement("div", { className: "example" },
            React.createElement("strong", null, "計算範例："), React.createElement("br"),
            "SpO₂ = 94、FiO₂ 輸入 60、RR = 25", React.createElement("br"),
            "→ 內部換算 FiO₂ = 0.60", React.createElement("br"),
            "→ SpO₂/FiO₂ = 94 / 0.60 ≈ 156.7", React.createElement("br"),
            "→ ROX = 156.7 / 25 ≈ 6.27（與文獻範例相符）"
          ),

          React.createElement("div", { className: "ref" },
            "⚠ 本工具僅供教學與初步評估參考，ROX Index 定義與 cut-off 參考相關研究與指引。[web:37][web:4][web:45][web:5]"
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
