<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown å³æ™‚ç·¨è¼¯é è¦½å™¨</title>

    <!-- Tailwind CSS (å« Typography æ’ä»¶ï¼Œç”¨æ–¼ç¾åŒ– Markdown è¼¸å‡º) -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                    }
                }
            }
        }
    </script>

    <!-- Marked.js (Markdown è§£æå™¨) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- DOMPurify (é˜²æ­¢ XSS æ”»æ“Š) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    
    <!-- Highlight.js (ç¨‹å¼ç¢¼èªæ³•é«˜äº®) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" id="hljs-theme">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Phosphor Icons (åœ–ç¤ºåº«) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* è‡ªè¨‚æ²è»¸æ¨£å¼ */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* ç·¨è¼¯å™¨å»é‚Šæ¡†èˆ‡å¤–æ¡† */
        textarea { outline: none; border: none; resize: none; }
        
        /* ç¢ºä¿é«˜äº®çš„ç¨‹å¼ç¢¼å€å¡Šåœ“è§’èˆ‡é–“è· */
        .prose pre { padding: 0; background-color: transparent; }
        .prose pre code { border-radius: 0.5rem; padding: 1rem !important; display: block; overflow-x: auto; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-gray-950 dark:text-gray-200 h-screen flex flex-col transition-colors duration-300">

    <!-- é ‚éƒ¨å°è¦½åˆ— -->
    <header class="flex items-center justify-between px-6 py-4 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 shadow-sm z-10">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-white shadow-md">
                <i class="ph ph-markdown-logo text-xl"></i>
            </div>
            <h1 class="text-xl font-bold tracking-wide">Markdown<span class="text-blue-600 dark:text-blue-500"> ç·¨è¼¯å™¨</span></h1>
        </div>
        
        <div class="flex items-center gap-4">
            <button id="copy-html-btn" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:text-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors">
                <i class="ph ph-copy"></i>
                <span class="hidden sm:inline">è¤‡è£½ HTML</span>
            </button>
            <button id="download-btn" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 shadow-sm transition-colors">
                <i class="ph ph-download-simple"></i>
                <span class="hidden sm:inline">ä¸‹è¼‰ .md</span>
            </button>
            <div class="w-px h-6 bg-gray-300 dark:bg-gray-700 mx-2"></div>
            <button id="theme-toggle" class="p-2 rounded-full text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 transition-colors">
                <i class="ph ph-moon text-xl" id="theme-icon"></i>
            </button>
        </div>
    </header>

    <!-- å·¥å…·åˆ— -->
    <div class="flex items-center gap-1 px-4 py-2 bg-gray-100 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-800 overflow-x-auto">
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="**" data-suffix="**" title="ç²—é«”">
            <i class="ph ph-text-b"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="*" data-suffix="*" title="æ–œé«”">
            <i class="ph ph-text-italic"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="~~" data-suffix="~~" title="åˆªé™¤ç·š">
            <i class="ph ph-text-strikethrough"></i>
        </button>
        <div class="w-px h-5 bg-gray-300 dark:bg-gray-600 mx-1"></div>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="### " data-suffix="" title="æ¨™é¡Œ">
            <i class="ph ph-text-h"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="> " data-suffix="" title="å¼•ç”¨">
            <i class="ph ph-quotes"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="`" data-suffix="`" title="è¡Œå…§ç¨‹å¼ç¢¼">
            <i class="ph ph-code"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="```\n" data-suffix="\n```" title="ç¨‹å¼ç¢¼å€å¡Š">
            <i class="ph ph-file-code"></i>
        </button>
        <div class="w-px h-5 bg-gray-300 dark:bg-gray-600 mx-1"></div>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="- " data-suffix="" title="ç„¡åºæ¸…å–®">
            <i class="ph ph-list-bullets"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="1. " data-suffix="" title="æœ‰åºæ¸…å–®">
            <i class="ph ph-list-numbers"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="[é€£çµåç¨±](" data-suffix=")" title="æ’å…¥é€£çµ">
            <i class="ph ph-link"></i>
        </button>
        <button class="toolbar-btn p-2 rounded hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors" data-prefix="![åœ–ç‰‡æè¿°](" data-suffix=")" title="æ’å…¥åœ–ç‰‡">
            <i class="ph ph-image"></i>
        </button>
    </div>

    <!-- ä¸»è¦å·¥ä½œå€ (å·¦å³åˆ†å‰²) -->
    <main class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <!-- å·¦å´ï¼šè¼¸å…¥å€ -->
        <section class="flex-1 h-1/2 md:h-full border-b md:border-b-0 md:border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 relative group">
            <div class="absolute top-2 right-4 text-xs font-semibold text-gray-400 select-none uppercase tracking-widest bg-white dark:bg-gray-900 px-2 py-1 rounded opacity-50">MARKDOWN</div>
            <textarea id="markdown-input" class="w-full h-full p-6 text-base font-mono leading-relaxed bg-transparent text-gray-800 dark:text-gray-200" placeholder="åœ¨æ­¤è¼¸å…¥ Markdown èªæ³•..."></textarea>
        </section>

        <!-- å³å´ï¼šé è¦½å€ -->
        <section class="flex-1 h-1/2 md:h-full overflow-y-auto bg-gray-50 dark:bg-gray-950 p-6 relative">
            <div class="absolute top-2 right-4 text-xs font-semibold text-gray-400 select-none uppercase tracking-widest opacity-50">PREVIEW</div>
            <!-- ä½¿ç”¨ Tailwind Typography (prose) ä¾†ç¾åŒ–è¼¸å‡º -->
            <div id="preview-output" class="prose prose-slate dark:prose-invert prose-blue max-w-none prose-pre:bg-gray-800 prose-pre:border prose-pre:border-gray-700">
                <!-- é è¦½å…§å®¹æœƒå‹•æ…‹ç”Ÿæˆåœ¨é€™è£¡ -->
            </div>
        </section>

    </main>

    <!-- æç¤ºæ¡† -->
    <div id="toast" class="fixed bottom-6 right-6 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2">
        <i class="ph ph-check-circle text-green-400 text-xl"></i>
        <span id="toast-message">æ“ä½œæˆåŠŸ</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const editor = document.getElementById('markdown-input');
            const preview = document.getElementById('preview-output');
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const downloadBtn = document.getElementById('download-btn');
            const copyHtmlBtn = document.getElementById('copy-html-btn');
            const toolbarBtns = document.querySelectorAll('.toolbar-btn');
            const hljsTheme = document.getElementById('hljs-theme');

            // åˆå§‹é è¨­å…§å®¹
            const initialMarkdown = `# æ­¡è¿ä½¿ç”¨ Markdown ç·¨è¼¯å™¨ ğŸ‘‹

é€™æ˜¯ä¸€å€‹æ¥µé€Ÿã€è¼•é‡ä¸”åŠŸèƒ½é½Šå…¨çš„ç·šä¸Š Markdown å³æ™‚é è¦½å·¥å…·ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

- **å³æ™‚æ¸²æŸ“**ï¼šå·¦å´è¼¸å…¥ï¼Œå³å´æ¯«ç§’ç´šåŒæ­¥å‘ˆç¾ã€‚
- **èªæ³•é«˜äº®**ï¼šè‡ªå‹•è­˜åˆ¥ç¨‹å¼ç¢¼ä¸¦çµ¦äºˆæ¼‚äº®çš„é¡è‰²æ¨™è¨˜ã€‚
- **æ·±è‰²æ¨¡å¼**ï¼šé»æ“Šå³ä¸Šè§’çš„æœˆäº®åœ–ç¤ºï¼Œä¿è­·æ‚¨çš„çœ¼ç›ã€‚
- **å®‰å…¨é˜²è­·**ï¼šå…§å»ºéæ¿¾å™¨ï¼Œè‡ªå‹•å‰”é™¤å±éšªçš„è…³æœ¬ï¼ˆXSSï¼‰ã€‚

### ğŸ“ æ ¼å¼å±•ç¤º

ä½ å¯ä»¥è¼•é¬†åœ°ä½¿ç”¨ **ç²—é«”**ã€*æ–œé«”* æˆ–æ˜¯ ~~åˆªé™¤ç·š~~ã€‚
å»ºç«‹æ¸…å–®ä¹Ÿéå¸¸ç›´è¦ºï¼š

1. æº–å‚™å¥½ä½ çš„æƒ³æ³•
2. å¯«ä¸‹ Markdown èªæ³•
3. åŒ¯å‡ºæˆæœï¼

> ã€ŒMarkdown æ˜¯ä¸€ç¨®è¼•å·§çš„æ¨™è¨˜èªè¨€ï¼Œè®“å¯«ä½œè€…å°ˆæ³¨æ–¼æ–‡å­—æœ¬èº«ï¼Œè€Œéç¹é›œçš„æ’ç‰ˆæ“ä½œã€‚ã€

### ğŸ’» ç¨‹å¼ç¢¼é«˜äº®æ”¯æ´

\`\`\`javascript
// æ”¯æ´å¤šç¨®èªè¨€çš„èªæ³•é«˜äº®
function calculateFibonacci(n) {
    if (n <= 1) return n;
    return calculateFibonacci(n - 1) + calculateFibonacci(n - 2);
}

console.log(calculateFibonacci(10)); // è¼¸å‡º 55
\`\`\`

---
è£½ä½œè¡¨æ ¼ï¼š

| å°ˆæ¡ˆ | ç‹€æ…‹ | é è¨ˆå®Œæˆæ—¥ |
| :--- | :---: | ---: |
| å‰ç«¯ä»‹é¢ | âœ… å®Œæˆ | 2023-10-01 |
| API ä¸²æ¥ | ğŸ”„ é€²è¡Œä¸­ | 2023-10-15 |

`;

            // è¨­å®š Marked.js å’Œ Highlight.js
            marked.setOptions({
                highlight: function(code, lang) {
                    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                    return hljs.highlight(code, { language }).value;
                },
                langPrefix: 'hljs language-', // highlight.js æœŸæœ›çš„ class å‰ç¶´
                breaks: true, // å…è¨±æ–·è¡Œ
                gfm: true     // å•Ÿç”¨ GitHub é¢¨æ ¼ Markdown
            });

            // æ¸²æŸ“å‡½æ•¸
            const renderMarkdown = () => {
                const rawMarkdown = editor.value;
                // è§£ææˆ HTML
                const rawHtml = marked.parse(rawMarkdown);
                // ä½¿ç”¨ DOMPurify æ¸…ç† HTMLï¼Œé˜²æ­¢ XSS
                const safeHtml = DOMPurify.sanitize(rawHtml);
                // æ”¾å…¥é è¦½å€
                preview.innerHTML = safeHtml;
            };

            // ç›£è½è¼¸å…¥äº‹ä»¶ï¼Œå³æ™‚æ›´æ–°
            editor.addEventListener('input', renderMarkdown);

            // åˆå§‹åŒ–å…§å®¹
            editor.value = initialMarkdown;
            renderMarkdown();

            // --- ä¸»é¡Œåˆ‡æ›é‚è¼¯ ---
            const toggleTheme = () => {
                const isDark = document.documentElement.classList.toggle('dark');
                if (isDark) {
                    themeIcon.classList.replace('ph-moon', 'ph-sun');
                    // hljsTheme.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css";
                } else {
                    themeIcon.classList.replace('ph-sun', 'ph-moon');
                    // hljsTheme.href = "https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css";
                }
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            };

            themeToggleBtn.addEventListener('click', toggleTheme);

            // æª¢æŸ¥ç³»çµ±åå¥½æˆ–æœ¬åœ°å„²å­˜
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                themeIcon.classList.replace('ph-moon', 'ph-sun');
            }

            // --- å·¥å…·åˆ—é‚è¼¯ ---
            toolbarBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const prefix = btn.getAttribute('data-prefix');
                    const suffix = btn.getAttribute('data-suffix');
                    
                    const start = editor.selectionStart;
                    const end = editor.selectionEnd;
                    const selectedText = editor.value.substring(start, end);
                    
                    const replacement = prefix + selectedText + suffix;
                    
                    editor.value = editor.value.substring(0, start) + replacement + editor.value.substring(end);
                    
                    // é‡æ–°èšç„¦ä¸¦è¨­å®šæ¸¸æ¨™ä½ç½®
                    editor.focus();
                    if (selectedText.length === 0) {
                        editor.selectionStart = editor.selectionEnd = start + prefix.length;
                    } else {
                        editor.selectionStart = start;
                        editor.selectionEnd = start + replacement.length;
                    }
                    
                    // è§¸ç™¼é‡æ–°æ¸²æŸ“
                    renderMarkdown();
                });
            });

            // --- è¼”åŠ©åŠŸèƒ½ï¼šToast æç¤º ---
            const showToast = (message) => {
                const toast = document.getElementById('toast');
                document.getElementById('toast-message').textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');
                
                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            };

            // --- ä¸‹è¼‰ Markdown æª”æ¡ˆ ---
            downloadBtn.addEventListener('click', () => {
                const text = editor.value;
                const blob = new Blob([text], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'document.md';
                a.click();
                URL.revokeObjectURL(url);
                showToast('æª”æ¡ˆä¸‹è¼‰æˆåŠŸï¼');
            });

            // --- è¤‡è£½æ¸²æŸ“å¾Œçš„ HTML ---
            copyHtmlBtn.addEventListener('click', () => {
                const htmlContent = preview.innerHTML;
                navigator.clipboard.writeText(htmlContent).then(() => {
                    showToast('å·²è¤‡è£½ HTML ç¨‹å¼ç¢¼ï¼');
                }).catch(err => {
                    console.error('è¤‡è£½å¤±æ•—: ', err);
                });
            });

            // æ”¯æ´ Tab éµç¸®æ’
            editor.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    
                    // æ’å…¥å…©å€‹ç©ºæ ¼ä½œç‚ºç¸®æ’ (å¯ä»¥æ”¹æˆ '\t' ä¾å€‹äººå–œå¥½)
                    this.value = this.value.substring(0, start) + "  " + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 2;
                    renderMarkdown();
                }
            });
        });
    </script>
</body>
</html>
